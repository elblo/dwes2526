
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://elblo.github.io/dwes2526/09laravelAvanzado.html">
      
      
        <link rel="prev" href="08laravelDatos.html">
      
      
        <link rel="next" href="10laravelAutenticacion.html">
      
      
        
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>9.- Laravel Avanzado - Desarrollo Web en Entorno Servidor</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#uso-avanzado-de-laravel" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="index.html" title="Desarrollo Web en Entorno Servidor" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Servidor" data-md-component="logo">
      
  <img src="imagenes/logoies.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Servidor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9.- Laravel Avanzado
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="Teal"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Desarrollo Web en Entorno Servidor" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Servidor" data-md-component="logo">
      
  <img src="imagenes/logoies.png" alt="logo">

    </a>
    Desarrollo Web en Entorno Servidor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inicio
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01arquitecturas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.- Arquitecturas Web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02php.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.- El lenguaje PHP
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03phpoo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3.- PHP Orientado a Objetos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04web.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.- Programación Web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05herramientas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5.- Herramientas Web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06accesoDatos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6.- Acceso a Datos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07frameworks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7.- Frameworks PHP - Laravel
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08laravelDatos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8.- Gestión de datos en Laravel
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    9.- Laravel Avanzado
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="09laravelAvanzado.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    9.- Laravel Avanzado
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#91-manejo-de-ficheros" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Manejo de ficheros
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 Manejo de ficheros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-del-almacenamiento" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuración del almacenamiento
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Almacenar archivos
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtener-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Obtener archivos
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eliminar-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Eliminar archivos
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listar-archivos-y-directorios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Listar archivos y directorios
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-enlace-simbolico" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crear enlace simbólico
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-subir-archivo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ejemplo subir archivo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-archivos-en-vistas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ejemplo archivos en vistas
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#92-request-y-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Request y Response
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.2 Request y Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#93-eloquent-relaciones" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3 Eloquent: Relaciones
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.3 Eloquent: Relaciones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relaciones-en-bbdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relaciones en BBDD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relaciones-en-eloquent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relaciones en Eloquent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relacion-uno-a-uno-1-a-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relación Uno a uno (1 a 1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relacion-uno-a-uno-inversa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relación Uno a Uno INVERSA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relacion-uno-a-muchos-1-a-m" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relación Uno a Muchos (1 a M)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relacion-uno-a-muchos-inversa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relación Uno a Muchos INVERSA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anadireliminar-elementos-relacionados" class="md-nav__link">
    <span class="md-ellipsis">
      
        Añadir/eliminar elementos relacionados
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relacion-muchos-a-muchos-mm-a-mm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relación Muchos a Muchos (MM a MM)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relacion-muchos-a-muchos-inversa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relación Muchos a Muchos INVERSA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anadireliminar-elementos-a-la-tabla-pivote" class="md-nav__link">
    <span class="md-ellipsis">
      
        Añadir/eliminar elementos a la tabla pivote
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relaciones-transitivas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relaciones transitivas
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-completo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ejemplo completo
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#94-mutadores-y-accesores" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.4 Mutadores y accesores
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#95-seeders-y-factorias" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5 Seeders y factorías
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.5 Seeders y factorías">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seeders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Seeders
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factorias" class="md-nav__link">
    <span class="md-ellipsis">
      
        Factorías
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#96-resumen" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.6 Resumen
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.6 Resumen">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i-manejo-de-ficheros-91" class="md-nav__link">
    <span class="md-ellipsis">
      
        I. Manejo de Ficheros (9.1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ii-request-y-response-92" class="md-nav__link">
    <span class="md-ellipsis">
      
        II. Request y Response (9.2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii-eloquent-relaciones-93" class="md-nav__link">
    <span class="md-ellipsis">
      
        III. Eloquent: Relaciones (9.3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iv-mutadores-y-accesores-94" class="md-nav__link">
    <span class="md-ellipsis">
      
        IV. Mutadores y Accesores (9.4)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v-seeders-y-factorias-95" class="md-nav__link">
    <span class="md-ellipsis">
      
        V. Seeders y Factorías (9.5)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#97-actividades" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.7 Actividades
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.7 Actividades">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manejo-de-ficheros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manejo de ficheros
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-y-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request y response
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent-relaciones" class="md-nav__link">
    <span class="md-ellipsis">
      
        Eloquent: Relaciones
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutadores-y-accesores" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mutadores y accesores
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seeders-y-factories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Seeders y factories
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practica-directorio-trabajadores" class="md-nav__link">
    <span class="md-ellipsis">
      
        Práctica: Directorio trabajadores
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practica-guiada-guia-de-equipos-de-futbol-femenino" class="md-nav__link">
    <span class="md-ellipsis">
      
        Práctica guiada: Guía de equipos de fútbol femenino
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practica-guia-de-estadios-de-futbol" class="md-nav__link">
    <span class="md-ellipsis">
      
        Práctica: Guía de estadios de fútbol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10laravelAutenticacion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10.- Autenticación y autorización
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11laravelAPI.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11.- Servicios REST
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<style>
    img { margin: 20px 0; border-radius: 8px; }

    .alert { color: #BD1550; }
    .warning { color: #E97F02; }
    .success { color: #8A9B0F; }

    .center { text-align: center; }
    .right { text-align: right; }

    .img-small { max-width: 200px; margin: auto; }
    .img-medium { max-width: 400px; margin: auto; }
    .img-large { max-width: 800px; margin: auto; }

    .leyenda {
        font-size: small;
        margin: 10px 0;
    }
</style>

<h1 id="uso-avanzado-de-laravel">Uso avanzado de Laravel<a class="headerlink" href="#uso-avanzado-de-laravel" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Duración estimada: 10 sesiones</p>
</blockquote>
<h2 id="91-manejo-de-ficheros">9.1 Manejo de ficheros<a class="headerlink" href="#91-manejo-de-ficheros" title="Permanent link">&para;</a></h2>
<p>Laravel proporciona una API sencilla y potente para trabajar con ficheros mediante el uso del sistema de almacenamiento basado en <strong>Flysystem</strong>. Esto permite interactuar con el sistema de archivos local y servicios en la nube como Amazon S3 o Dropbox de manera uniforme.</p>
<h3 id="configuracion-del-almacenamiento">Configuración del almacenamiento<a class="headerlink" href="#configuracion-del-almacenamiento" title="Permanent link">&para;</a></h3>
<p>Laravel usa la configuración del sistema de archivos en <code>config/filesystems.php</code>. El driver por defecto es <code>local</code>, pero se pueden configurar otros como <code>s3</code> o <code>public</code> mediante <strong>FILESYSTEM_DISK</strong> en el <strong>fichero .env</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Configuración del disco local privado, público y o s3</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;FILESYSTEM_DISK&#39;</span><span class="p">,</span> <span class="s1">&#39;local&#39;</span><span class="p">),</span> <span class="c1">// local | public | s3 definido en .env y si no lo está, &#39;local&#39;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="s1">&#39;disks&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>            <span class="s1">&#39;root&#39;</span> <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/private&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="11 "></span>            <span class="s1">&#39;serve&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span>            <span class="s1">&#39;throw&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span>            <span class="s1">&#39;report&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">],</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>        <span class="s1">&#39;public&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
<span class="linenos" data-linenos="17 "></span>            <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="18 "></span>            <span class="s1">&#39;root&#39;</span> <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/public&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="19 "></span>            <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_URL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;/storage&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span>            <span class="s1">&#39;visibility&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span>            <span class="s1">&#39;throw&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span>            <span class="s1">&#39;report&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span>        <span class="p">],</span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span>        <span class="s1">&#39;s3&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
<span class="linenos" data-linenos="26 "></span>            <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="27 "></span>            <span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_ACCESS_KEY_ID&#39;</span><span class="p">),</span> <span class="c1">// Definidas en .env</span>
<span class="linenos" data-linenos="28 "></span>            <span class="s1">&#39;secret&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="29 "></span>            <span class="s1">&#39;region&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_DEFAULT_REGION&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="30 "></span>            <span class="s1">&#39;bucket&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_BUCKET&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="31 "></span>            <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_URL&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="32 "></span>            <span class="s1">&#39;endpoint&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_ENDPOINT&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="33 "></span>            <span class="s1">&#39;use_path_style_endpoint&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_USE_PATH_STYLE_ENDPOINT&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
<span class="linenos" data-linenos="34 "></span>            <span class="s1">&#39;throw&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="linenos" data-linenos="35 "></span>            <span class="s1">&#39;report&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="linenos" data-linenos="36 "></span>        <span class="p">],</span>
<span class="linenos" data-linenos="37 "></span>    <span class="p">],</span>
<span class="linenos" data-linenos="38 "></span><span class="p">];</span>
</code></pre></div>
<h3 id="almacenar-archivos">Almacenar archivos<a class="headerlink" href="#almacenar-archivos" title="Permanent link">&para;</a></h3>
<p>Para subir y guardar archivos en Laravel, se utiliza la clase <code>Illuminate\Support\Facades\Storage</code>. A sus métodos se les pasa el <em>path</em> y <em>nombre</em> del archivo con el que operar. Hay que tener en cuenta que el <em>path</em> se indica a partir del disco configurado en el punto anterior, así que, si por ejemplo queremos almacenar un archivo en <code>/storage/app/private/archivos</code> únicamente habría que indicar como path <code>archivos</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Función &#39;storage&#39; en controlador que recibe los datos del formulario</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Storage</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">// &#39;imagen&#39; es el atributo name del input type file del formulario</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="s1">&#39;imagen&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|image|mimes:jpeg,png,jpg,gif|max:2048&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">]);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1">// Opción 1.1 Guardar un archivo en el disco &#39;local&#39; (&#39;storage/app/private/archivos/&#39;)</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;imagen&#39;</span><span class="p">));</span> <span class="c1">// Storage siempre a `local` por defecto </span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;imagen&#39;</span><span class="p">));</span> <span class="c1">// Elegir el disco al que guardar </span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="c1">// Opción 1.2: Guardar archivo con nombre específico</span>
<span class="linenos" data-linenos="15 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">putFileAs</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;imagen&#39;</span><span class="p">),</span> <span class="s1">&#39;mi_imagen.jpg&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span> <span class="c1">// Opción 2.1: Guardar desde $request</span>
<span class="linenos" data-linenos="18 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;imagen&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span> <span class="c1">// &#39;local&#39; por defecto --&gt; Guarda en &#39;storage/app/private/archivos/&#39;</span>
<span class="linenos" data-linenos="19 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;imagen&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span> <span class="c1">// &#39;public&#39; --&gt; Guarda en &#39;storage/app/public/archivos/&#39;</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="c1">// Opción 2.2: Guardar desde $request con nombre específico</span>
<span class="linenos" data-linenos="22 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;archivo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">storeAs</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">,</span> <span class="s1">&#39;nuevonombre.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="c1">// Opción 2.3: Guardar desde $request con nombre específico sin perder la extensión original</span>
<span class="linenos" data-linenos="25 "></span><span class="nv">$extension</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;archivo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">();</span>    
<span class="linenos" data-linenos="26 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;archivo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">storeAs</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">,</span> <span class="s1">&#39;nuevonombre.&#39;</span><span class="o">.</span> <span class="nv">$extension</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span><span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;Imagen subida con éxito a la ruta:&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">);</span> <span class="c1">// Vuelve atrás pasando la variable &#39;success&#39; por la sesión  </span>
</code></pre></div>
<h3 id="obtener-archivos">Obtener archivos<a class="headerlink" href="#obtener-archivos" title="Permanent link">&para;</a></h3>
<p>Cuando accedamos al <strong>storage</strong> siempre va a buscar a partir del directorio correspondiente al disco configurado en filesystem.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Obtener el contenido de un archivo (con ficheros de texto, no imágenes)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$contenido</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;archivos/mi_archivo.pdf&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">echo</span> <span class="nv">$contenido</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// Verificar si un archivo existe del disco &#39;local&#39; o del &#39;public&#39;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">if</span> <span class="p">(</span><span class="nx">Storage</span><span class="o">::</span><span class="na">exists</span><span class="p">(</span><span class="s1">&#39;archivos/mi_archivo.pdf&#39;</span><span class="p">))</span> <span class="k">echo</span> <span class="s2">&quot;El archivo existe.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">if</span> <span class="p">(</span><span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">(</span><span class="s1">&#39;archivos/mi_archivo.pdf&#39;</span><span class="p">))</span> <span class="k">echo</span> <span class="s2">&quot;El archivo existe.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1">// Descargar un archivo</span>
<span class="linenos" data-linenos="11 "></span><span class="k">return</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">download</span><span class="p">(</span><span class="s1">&#39;archivos/mi_archivo.pdf&#39;</span><span class="p">);</span>
</code></pre></div>
<h3 id="eliminar-archivos">Eliminar archivos<a class="headerlink" href="#eliminar-archivos" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Eliminar un archivo del disco &#39;local&#39; o del &#39;public&#39;</span>
<span class="linenos" data-linenos="3 "></span><span class="nx">Storage</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;archivos/mi_archivo.pdf&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;archivos/mi_archivo.pdf&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="c1">// Eliminar múltiples archivos</span>
<span class="linenos" data-linenos="6 "></span><span class="nx">Storage</span><span class="o">::</span><span class="na">delete</span><span class="p">([</span><span class="s1">&#39;archivos/archivo1.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;archivos/archivo2.pdf&#39;</span><span class="p">]);</span>
</code></pre></div>
<h3 id="listar-archivos-y-directorios">Listar archivos y directorios<a class="headerlink" href="#listar-archivos-y-directorios" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Obtener todos los archivos de un directorio del disco &#39;local&#39; o del &#39;public&#39;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$archivos</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">files</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$archivos</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">files</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$archivos</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// Obtener todos los archivos de un directorio incluyendo subdirectorios</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$archivos</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">allFiles</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$archivos</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// Obtener sólo los directorios</span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$directorios</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">directories</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$directorios</span><span class="p">);</span>
</code></pre></div>
<h3 id="crear-enlace-simbolico">Crear enlace simbólico<a class="headerlink" href="#crear-enlace-simbolico" title="Permanent link">&para;</a></h3>
<p>Para acceder a archivos desde el navegador mediante su ruta y poder incluirlos en las vistas, es necesario crear un enlace simbólico en <code>/public</code> que apunte a  <code>/storage/app/public</code> (o donde mande el disco configurado). Para ello, desde la raíz del proyecto ejecuta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan storage:link</span>
</code></pre></div>
<p>En <code>/public</code> se habrá creado el enlace símbolico <strong>storage</strong>, que en la práctica es como si tuviésemos ahí los archivos. </p>
<h3 id="ejemplo-subir-archivo">Ejemplo subir archivo<a class="headerlink" href="#ejemplo-subir-archivo" title="Permanent link">&para;</a></h3>
<p>En la vista:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;subir.archivo&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>    @csrf
<span class="linenos" data-linenos="3 "></span>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;archivo&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Subir<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
<p>En el controlador:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Storage</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">subirArchivo</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;archivo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|file|max:2048&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;archivo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">return</span> <span class="s2">&quot;Archivo subido a: &quot;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="ejemplo-archivos-en-vistas">Ejemplo archivos en vistas<a class="headerlink" href="#ejemplo-archivos-en-vistas" title="Permanent link">&para;</a></h3>
<p>En el controlador:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">muestraArchivos</span><span class="p">(){</span>
<span class="linenos" data-linenos="3 "></span>      <span class="nv">$paths</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">allFiles</span><span class="p">(</span><span class="s1">&#39;archivos&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>      <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;archivos.muestra&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;paths&#39;</span><span class="p">));</span> 
<span class="linenos" data-linenos="5 "></span>  <span class="p">}</span>
</code></pre></div>
<p>En la vista:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Listado de imágenes<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="3 "></span>  @foreach ($paths as $path)
<span class="linenos" data-linenos="4 "></span>      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ Storage::url($path) }}&quot;</span> <span class="p">/&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="5 "></span>  @endforeach
<span class="linenos" data-linenos="6 "></span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<h2 id="92-request-y-response">9.2 Request y Response<a class="headerlink" href="#92-request-y-response" title="Permanent link">&para;</a></h2>
<p>Las peticiones y respuestas permiten interactuar con la solicitud HTTP que llega y que se devuelve, por lo que se suelen utilizar en alguna función del controlador al que dirige una ruta determinada. Más info en la <a href="https://laravel.com/docs/master/requests">documentación oficial</a>.</p>
<h3 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h3>
<p>La clase <code>Illuminate\Http\Request</code> de Laravel proporciona una forma orientada a objetos de interactuar con la solicitud HTTP actual que maneja la aplicación, así como también de recuperar la entrada, las cookies y los archivos que se enviaron con la solicitud.</p>
<h4 id="acceso-a-los-datos-de-la-peticion">Acceso a los datos de la petición<a class="headerlink" href="#acceso-a-los-datos-de-la-peticion" title="Permanent link">&para;</a></h4>
<p>Se pueden obtener los elementos enviados a la petición de diferentes formas. Recuerda que se recuperan por el campo <code>name</code> que hayas especificado en el formulario.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$input</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span> <span class="c1">//Acceder a todos los inputs</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">//Obtener un input específico</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="c1">//Obtener un input específico</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$age</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span> <span class="c1">//Especificar valores por defecto</span>
<span class="linenos" data-linenos="6 "></span><span class="nv">$id</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span> <span class="c1">//Acceder a parámetros de ruta</span>
</code></pre></div>
<p>También es posible comprobar si en la petición se han recibido ciertos elementos, si vienen rellenos, excluirlos...</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="c1">// Input &#39;email&#39; se ha recibido</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
<span class="linenos" data-linenos="5 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">filled</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="6 "></span>    <span class="c1">// Input &#39;name&#39; no está vacío</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
<span class="linenos" data-linenos="8 "></span><span class="nv">$filtered</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]);</span> <span class="c1">// Filtrar inputs específicos</span>
<span class="linenos" data-linenos="9 "></span><span class="nv">$excluded</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">except</span><span class="p">([</span><span class="s1">&#39;password&#39;</span><span class="p">]);</span> <span class="c1">// Excluir ciertos inputs</span>
</code></pre></div>
<h4 id="tratamiento-de-archivos">Tratamiento de archivos<a class="headerlink" href="#tratamiento-de-archivos" title="Permanent link">&para;</a></h4>
<p>Los archivos se tratan de forma similar.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Comprobar si se ha recibido el archivo con name &#39;photo&#39;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">hasFile</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">))</span> <span class="p">{</span> 
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// Almacenar el archivo en el storage configurado</span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">);</span> 
</code></pre></div>
<h3 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h3>
<p>Una instancia de Response hereda de la clase <code>Symfony\Component\HttpFoundation\Response</code> y proporciona una variedad de métodos para personalizar el código de estado HTTP y los encabezados de la respuesta.</p>
<h4 id="crear-respuestas">Crear respuestas<a class="headerlink" href="#crear-respuestas" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Respuesta básica</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> 
<span class="linenos" data-linenos=" 4 "></span><span class="c1">// Respuesta en formato JSON</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">]);</span> 
<span class="linenos" data-linenos=" 9 "></span> <span class="c1">// Redirección</span>
<span class="linenos" data-linenos="10 "></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">// Redirección pasando la variable &#39;status&#39;</span>
<span class="linenos" data-linenos="12 "></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;Sesión iniciada&#39;</span><span class="p">);</span> 
</code></pre></div>
<h4 id="manipular-cabeceras">Manipular cabeceras<a class="headerlink" href="#manipular-cabeceras" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Respuesta añadiendo 1 cabecera</span>
<span class="linenos" data-linenos="3 "></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">// Respuesta añadiendo múltiples cabeceras</span>
<span class="linenos" data-linenos="5 "></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span>  <span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="7 "></span>  <span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Cache-Control&#39;</span><span class="p">,</span> <span class="s1">&#39;no-cache&#39;</span><span class="p">);</span>
</code></pre></div>
<h4 id="respuestas-de-archivos">Respuestas de archivos<a class="headerlink" href="#respuestas-de-archivos" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">download</span><span class="p">(</span><span class="nv">$pathToFile</span><span class="p">);</span> <span class="c1">// Descarga archivo</span>
<span class="linenos" data-linenos="3 "></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="nv">$pathToFile</span><span class="p">);</span> <span class="c1">// Mostrar archivo</span>
</code></pre></div>
<h2 id="93-eloquent-relaciones">9.3 Eloquent: Relaciones<a class="headerlink" href="#93-eloquent-relaciones" title="Permanent link">&para;</a></h2>
<p>A través de Eloquent vamos a poder gestionar las relaciones entre nuestras tablas de la base de datos de una manera muy sencilla y sin sentencias SQL. Más info sobre relaciones, como siempre, en la <a href="https://laravel.com/docs/11.x/eloquent-relationships">documentación oficial</a>.</p>
<h3 id="relaciones-en-bbdd">Relaciones en BBDD<a class="headerlink" href="#relaciones-en-bbdd" title="Permanent link">&para;</a></h3>
<p>En una base de datos relacional, las relaciones son las conexiones entre las tablas, que se establecen a través de las claves primarias y foráneas. Para obtener datos de varias tablas, podemos hacerlo de 2 formas:</p>
<ul>
<li><em>JOIN</em>: Unir las tablas a través de las claves primarias y foráneas.</li>
<li><em>Relaciones</em>: Definir las relaciones en los modelos, y acceder a los datos a través de las relaciones.</li>
</ul>
<p>Las relaciones que existen en una base de datos relacional son:</p>
<ul>
<li><strong>Uno a Uno</strong>: Un registro de una tabla se relaciona con un único registro de otra tabla.</li>
<li><strong>Uno a Muchos</strong>: Un registro de una tabla se relaciona con varios registros de otra tabla.</li>
<li><strong>Muchos a Muchos</strong>: Varios registros de una tabla se relacionan con varios registros de otra tabla.</li>
<li><strong>Uno a Uno Polimórfica</strong>: Un registro de una tabla puede relacionarse con un único registro de varias tablas.</li>
<li><strong>Uno a Muchos Polimórfica</strong>: Un registro de una tabla puede relacionarse con varios registros de varias tablas.</li>
<li><strong>Muchos a Muchos Polimórfica</strong>: Varios registros de una tabla pueden relacionarse con varios registros de varias tablas.</li>
</ul>
<p>Nota: Relaciones polimórficas son aquellas en las que una tabla se relaciona con varias tablas.</p>
<h3 id="relaciones-en-eloquent">Relaciones en Eloquent<a class="headerlink" href="#relaciones-en-eloquent" title="Permanent link">&para;</a></h3>
<p>Eloquent nos permite definir las relaciones entre los modelos, y acceder a los datos a través de ellas. Tipos:</p>
<ul>
<li><strong>Uno a Uno</strong>: <code>hasOne()</code>, <code>belongsTo()</code></li>
<li><strong>Uno a Muchos</strong>: <code>hasMany()</code>, <code>belongsTo()</code></li>
<li><strong>Muchos a Muchos</strong>: <code>belongsToMany()</code></li>
<li><strong>Uno a Uno Polimórfica</strong>: <code>morphOne()</code>, <code>morphTo()</code></li>
<li><strong>Uno a Muchos Polimórfica</strong>: <code>morphMany()</code>, <code>morphTo()</code></li>
<li><strong>Muchos a Muchos Polimórfica</strong>: <code>morphToMany()</code>, <code>morphedByMany()</code></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Dónde situar los métodos</p>
<p>Los métodos <code>hasOne()/hasMany()</code> irán en el modelo del lado fuerte de la relación (el que propaga su clave primaria).</p>
<p>El método <code>belongsTo()</code> irá en el modelo de la parte débil de la relación, la que tiene la <strong>clave foránea</strong>. </p>
<p>Ejemplo: En un esquema en el que un usuario tiene muchas notas, en el modelo <strong>Usuario</strong> irá el <code>hasMany()</code> y en <strong>Nota</strong> irá el <code>belongsTo()</code>. Su tabla correspondiente <em>notas</em> tiene la clave foránea ´usuario_id´.</p>
</div>
<h3 id="relacion-uno-a-uno-1-a-1">Relación Uno a uno (1 a 1)<a class="headerlink" href="#relacion-uno-a-uno-1-a-1" title="Permanent link">&para;</a></h3>
<p>Para crear este tipo de relaciones en Eloquent y Laravel, debemos tener creadas las tablas que vayamos a relacionar y establecer la relación entre ellas a través del método <code>hasOne()</code> y <code>belongsTo()</code>.</p>
<p>Supongamos que tenemos una tabla <code>usuario</code> que está relacionada con la tabla <code>telefono</code> (en la migración de teléfono se indica mediante la clave foránea: <code>$table-&gt;foreignId('usuario_id')-&gt;constrained('usuarios');</code>). </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Usuario</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="c1">// Obtener el Teléfono asocioado con el Usuario</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">telefono</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="nx">Telefono</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<p>Una vez hecho ésto, para poder recuperar el dato relacionado, debemos utilizar las propiedades dinámicas de Eloquent. Con estas propiedades dinámicas podremos obtener dicho dato.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$telefono</span> <span class="o">=</span> <span class="nx">Usuario</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">telefono</span><span class="p">;</span>
</code></pre></div>
<p>En este caso, Eloquent asume que en <code>Telefono</code> existe la clave ajena <code>usuario_id</code> pero ¿qué pasa si tenemos otro nombre? pues se lo pasamos como parámetro.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="nx">Telefono</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;clave_ajena&#39;</span><span class="p">);</span>
</code></pre></div>
<h3 id="relacion-uno-a-uno-inversa">Relación Uno a Uno <strong><em>INVERSA</em></strong><a class="headerlink" href="#relacion-uno-a-uno-inversa" title="Permanent link">&para;</a></h3>
<p>Ahora que podemos acceder al modelo teléfono desde el modelo usuario, vamos a ver cómo hacerlo de manera inversa, es decir, cómo acceder desde el modelo <code>telefono</code> al modelo <code>usuario</code> mediante el método <code>belongsTo()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Telefono</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">usuario</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">Usuario</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<p>Al llamar el método de <code>usuario</code>, Eloquent intentará encontrar un modelo Usuario que tenga un <code>id</code> que coincida con la columna de <code>usuario_id</code> en el modelo de <code>telefono</code>.</p>
<p>Eloquent determina el nombre de la clave externa examinando el nombre del método de relación y agregando el sufijo <code>_id</code> al nombre del método. Entonces, asume que el modelo <code>Telefono</code> tiene una columna <code>usuario_id</code>. Sin embargo, si no se llama de esa manera, puedes pasarle como argumento el nombre de la clave.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">usuario</span><span class="p">()</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">Usuario</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;clave_ajena&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Lado fuerte y débil de la relación 1 a 1</p>
<p>En las relaciones 1 a 1 también hay un lado fuerte y otro débil. En el ejemplo anterior, <code>Usuario</code> sería el fuerte y <code>Telefono</code> el débil, porque un un usuario puede existir sin un télefono, pero un teléfono sólo tiene sentido si pertenece a un usuario.</p>
</div>
<h3 id="relacion-uno-a-muchos-1-a-m">Relación Uno a Muchos (1 a M)<a class="headerlink" href="#relacion-uno-a-muchos-1-a-m" title="Permanent link">&para;</a></h3>
<p>Por ejemplo, las entradas de un blog o un post tienen muchos comentarios.</p>
<p>Pero antes, ya sabemos que debemos crear ambas clases del modelo con sus migraciones indicando en la tabla "débil" la clave foránea, igual que se ha hecho antes.  </p>
<p>Ahora, en el modelo "fuerte" usaremos el método <code>hasMany()</code> para obtener los datos relacionados con ese post o entrada en el blog.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">comentarios</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">Comentario</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<p>Cuidado con las claves ajenas, que aquí pasa lo mismo... Eloquent establece por defecto el sufijo <code>_id</code> por lo tanto, en este ejemplo buscaría por <code>post_id</code>. Si nuestra clave ajena tiene otro nombre, se lo pasamos por parámetro en el método <code>hasMany</code> como hacíamos más arriba.</p>
<p>Hay que tener en cuenta que <code>hasMany</code> devuelve un array de elemento.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$comentarios</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">comentarios</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$comentarios</span> <span class="k">as</span> <span class="nv">$comentario</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="7 "></span>    <span class="c1">// Lo que sea que hagamos con esos datos o pasar el array directamente a la vista</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<p>Además, como todas las relaciones son sentencias SQL, podemos anidar varios filtros en función de lo que queramos sacar.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$comentario = Post::find(1)-&gt;comentarios()</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    -&gt;where(&#39;titulo&#39;, &#39;lo que sea&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    -&gt;first();</span>
</code></pre></div>
<h3 id="relacion-uno-a-muchos-inversa">Relación Uno a Muchos <strong><em>INVERSA</em></strong><a class="headerlink" href="#relacion-uno-a-muchos-inversa" title="Permanent link">&para;</a></h3>
<p>Ahora que podemos acceder a todos los comentarios de una publicación, definamos una relación para permitir que un comentario acceda a su publicación principal.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Comentario</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">post</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">Post</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<p>Y ahora, a través de la propiedad de relación dinámica...</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">use</span> <span class="nx">App\Models\Comentario</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$comentario</span> <span class="o">=</span> <span class="nx">Comentario</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="k">return</span> <span class="nv">$comentario</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">titulo</span><span class="p">;</span>
</code></pre></div>
<p>Pasaría lo mismo con el nombre de la clave ajena, si no se llama de la misma manera que Eloquent establece con el sufijo <code>_id</code> podemos pasarle como parámetro el nombre de la clave donde debe buscar.</p>
<h3 id="anadireliminar-elementos-relacionados">Añadir/eliminar elementos relacionados<a class="headerlink" href="#anadireliminar-elementos-relacionados" title="Permanent link">&para;</a></h3>
<p>En las relaciones de 1 a muchos hay varias formas de añadir elementos relacionados:</p>
<ol>
<li>Asignación manual mediante clave ajena.</li>
<li>Asignar un un objeto existente.</li>
<li>Asignar un objeto creándolo.</li>
</ol>
<p>En el siguiente ejemplo de 1 post que tiene muchos comentarios se ven las 3 formas:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">titulo</span> <span class="o">=</span> <span class="s2">&quot;Fundamentos de programación en Laravel&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// Forma 1 de asignar 1 comentario a 1 post (directamente mediante su clave ajena)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$comentario</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comentario</span><span class="p">();</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$comentario</span><span class="o">-&gt;</span><span class="na">texto</span> <span class="o">=</span> <span class="s2">&quot;Me parecen muy interesantes los conceptos tratados en el post.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$comentario</span><span class="o">-&gt;</span><span class="na">autor</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$comentario</span><span class="o">-&gt;</span><span class="na">post_id</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span> <span class="c1">// Clave ajena &#39;post_id&#39;</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$comentario</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="c1">// Forma 2 de asignar 1 comentario a 1 post (si ya EXISTE el comentario)</span>
<span class="linenos" data-linenos="14 "></span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">comentarios</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$comentario</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="c1">// Forma 3 de asignar 1 comentario a 1 post (CREANDO del tirón el comentario) --&gt; fillable en Comentario.php</span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">comentarios</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
<span class="linenos" data-linenos="18 "></span>    <span class="s1">&#39;texto&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Me parecen muy interesantes los conceptos tratados en el post.&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="19 "></span>    <span class="s1">&#39;autor&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="p">]);</span>
</code></pre></div>
<details class="notice">
<summary>Nota sobre la forma 2</summary>
<p>La 2ª forma está pensada para objetos ya creados y que por tanto ya tienen la clave ajena rellena (pertenecen a un post). En el ejemplo, al asignar el comenario ya creado a otro post, simplemente cambiará su <code>post_id</code>. </p>
<p>Pero también es posible crear un nuevo comentario de la 2ª forma sin necesidad de vincular manualmente la clave ajena. Se hace, sin llegar a guardarlo desde comentario, pero sí desde post:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$comentario2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comentario</span><span class="p">();</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$comentario2</span><span class="o">-&gt;</span><span class="na">texto</span> <span class="o">=</span> <span class="s2">&quot;A mi también me parecen muy interesantes.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$comentario2</span><span class="o">-&gt;</span><span class="na">autor</span> <span class="o">=</span> <span class="s2">&quot;Mary Jane&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">comentarios</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$comentario2</span><span class="p">);</span> <span class="c1">// Aquí se vincula la clave ajena y se buarda el comentario</span>
</code></pre></div>
</details>
<h3 id="relacion-muchos-a-muchos-mm-a-mm">Relación Muchos a Muchos (MM a MM)<a class="headerlink" href="#relacion-muchos-a-muchos-mm-a-mm" title="Permanent link">&para;</a></h3>
<p>Este tipo de relaciones son las más complicadas. Por ejemplo, en un blog como Wordpress, un usuario puede tener muchos roles (lector, autor, administrador) pero un rol pueden tenerlo varios usuarios, es decir, puede haber muchos usuarios administradores, otros lectores y demás.</p>
<p>Para realizar este tipo de relaciones necesitaríamos 3 tablas diferentes.</p>
<ul>
<li>usuarios [id, nombre]</li>
<li>roles [id, nombre]</li>
<li>rol_usuario [usuario_id, rol_id] (Tabla Pivote)</li>
</ul>
<p>Lo primero de todo, vamos a crear las tablas con sus modelos <span class="alert"><strong><em>a excepción de la tabla pivote "rol_usuario"</em></strong></span>, de la que <span class="warning"><strong><em>sólo crearemos la tabla, sin su modelo</em></strong></span></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan make:migration create_rol_usuario_table --create=rol_usuario</span>
</code></pre></div>
<p>Y la estructura de dicha tabla quedaría:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;rol_usuario&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bigIncrements</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span> <span class="c1">// creates an auto-incrementing UNSIGNED BIGINT (primary key) equivalent column</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">unsignedInteger</span><span class="p">(</span><span class="s1">&#39;usuario_id&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">unsignedInteger</span><span class="p">(</span><span class="s1">&#39;rol_id&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>        <span class="c1">// También se podían haber definido como cláves foráneas</span>
<span class="linenos" data-linenos="12 "></span>        <span class="c1">// $table-&gt;foreignId(&#39;usuario_id&#39;)-&gt;constrained(&#39;usuarios&#39;);</span>
<span class="linenos" data-linenos="13 "></span>        <span class="c1">// $table-&gt;foreignId(&#39;rol_id&#39;)-&gt;constrained(&#39;rols&#39;); // Ojo con el nombre</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">});</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<p>Ahora que ya tenemos todo listo, las relaciones de Muchos a Muchos vienen definidas por un método que devuelve el resultado de usar el método <code>belongsToMany()</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Usuario</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">roles</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Rol</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;rol_usuario&#39;</span><span class="p">);</span> <span class="c1">// se indica la tabla pivote</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<p>Como 2º parámetro de <code>belongsToMany</code> se puede indicar la tabla intermedia (pivote) de la relación <code>rol_usuario</code>. Útil, si se utiliza un nombre que Laravel no puede deducir a partir de los modelos.</p>
<p>Una vez que tengamos las relaciones definidas, accederemos a ellas mediante las propiedades dinámicas de <code>roles</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="k">use</span> <span class="nx">App\Models\Usuario</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$usuario</span> <span class="o">=</span> <span class="nx">Usuario</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$usuario</span><span class="o">-&gt;</span><span class="na">roles</span> <span class="k">as</span> <span class="nv">$rol</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="8 "></span>    <span class="c1">// nuestro código</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<p>Acordaros que podemos encadenar comandos sql a través de los métodos de Eloquent</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$roles</span> <span class="o">=</span> <span class="nx">Usuario</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<h3 id="relacion-muchos-a-muchos-inversa">Relación Muchos a Muchos <strong><em>INVERSA</em></strong><a class="headerlink" href="#relacion-muchos-a-muchos-inversa" title="Permanent link">&para;</a></h3>
<p>Para definir la parte "inversa" de una relación de muchos a muchos, debemos establecer un método en el modelo relacionado que también devuelva el resultado del método <code>belongsToMany</code>. En este caso, se hace exactamente igual en ambas partes de la relación. Según el ejemplo que estamos siguiendo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">Rol</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">usuarios</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Usuario</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;rol_usuario&#39;</span><span class="p">);</span> <span class="c1">// se indica la tabla pivote</span>
<span class="linenos" data-linenos="12 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="anadireliminar-elementos-a-la-tabla-pivote">Añadir/eliminar elementos a la tabla pivote<a class="headerlink" href="#anadireliminar-elementos-a-la-tabla-pivote" title="Permanent link">&para;</a></h3>
<p>Laravel proporciona una serie de métodos para añadir/eliminar elementos a la tabla pivote en las relaciones de Muchos a Muchos. Estos son:</p>
<ul>
<li><code>attach()</code>: Añade a la tabla pivote los elementos pasados.</li>
<li><code>detach()</code>: Elimina de la tabla pivote los elementos pasados.</li>
<li><code>toggle()</code>: Añade un elemento si no existe, y lo elimina si ya existe.</li>
<li><code>sync()</code>: Deja en la tabla pivote sólo los elementos que se le pasen.</li>
</ul>
<p>Los métodos anteriores admiten un único <strong>id</strong>, un <strong>array de ids</strong> o el propio <strong>objeto</strong>. Ejemplos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>  <span class="k">use</span> <span class="nx">App\Models\Usuario</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>  <span class="k">use</span> <span class="nx">App\Models\Rol</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="c1">// Recuperar usuario con id 1</span>
<span class="linenos" data-linenos=" 6 "></span>  <span class="nv">$usuario</span> <span class="o">=</span> <span class="nx">Usuario</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="c1">// Añadirle roles por sus ids</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="nv">$usuario</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>  <span class="c1">// Quitarle roles por sus ids</span>
<span class="linenos" data-linenos="12 "></span>  <span class="nv">$usuario</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>  <span class="c1">// Elimina el 1 (ya existía) y añade el 2 (no existía)</span>
<span class="linenos" data-linenos="15 "></span>  <span class="nv">$usuario</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toggle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>  <span class="c1">// Sincroniza con los elementos pasados (sólo deja estos en la tabla pivote)</span>
<span class="linenos" data-linenos="18 "></span>  <span class="nv">$usuario</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">sync</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>  <span class="c1">// También se pueden releacionar mediante el propio objeto</span>
<span class="linenos" data-linenos="21 "></span>  <span class="nv">$rol</span> <span class="o">=</span> <span class="nx">Rol</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>  <span class="nv">$usuario</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$rol</span><span class="p">);</span> <span class="c1">// En este caso da error porque ya tiene dicho rol (1)</span>
</code></pre></div>
<h3 id="relaciones-transitivas">Relaciones transitivas<a class="headerlink" href="#relaciones-transitivas" title="Permanent link">&para;</a></h3>
<p>Las relaciones transitivas <strong>Has One Through</strong> y <strong>Has Many Through</strong> nos permiten una forma de acceder a tablas lejanas, que no están directamente relacionadas entre sí. Por ejemplo, Un Editor tiene muchos Post, y un Post tiene muchos Comment. Si queremos acceder a los Comment de un Editor, podemos hacerlo a través de la relación Has Many Through.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">Editor</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">comments</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasManyThrough</span><span class="p">(</span><span class="nx">Comment</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">Post</span><span class="o">::</span><span class="na">Class</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="ejemplo-completo">Ejemplo completo<a class="headerlink" href="#ejemplo-completo" title="Permanent link">&para;</a></h3>
<p>Vamos a hacer un ejemplo con una APP que gestione alumnos y asignaturas, de tal manera que <strong>muchos alumnos pueden cursar muchas asignaturas</strong>.</p>
<p>¿Qué necesitamos para este ejemplo?</p>
<ul>
<li>2 <strong>modelos</strong>:  <code>Alumno</code> y <code>Materia</code>.</li>
<li>3 migraciones para crear las tablas: <code>alumnos</code>, <code>materias</code> y <code>alumno_materia</code> (tabla pivote).</li>
<li>Modificar los archivos de las migraciones <code>create_alumnos_table</code> y <code>create_materias_table</code> añadiendo los campos que se necesiten.</li>
<li>Ejecutar las migraciones.</li>
<li>Rellenar la base de datos con alguna información de prueba.</li>
<li>Método dentro de <code>Alumno</code> para crear la relación Alumno-&gt;Materia.</li>
<li>Método dentro de <code>Materia</code> para crear la relación Materia-&gt;Alumno. </li>
<li>Crear las rutas necesarias para ambas peticiones.</li>
<li>Crear las funciones necesarias en los controladores que redirijan a la vistas.</li>
<li>Crear las vistas.</li>
</ul>
<h4 id="1-crear-los-modelos">1. Crear los modelos<a class="headerlink" href="#1-crear-los-modelos" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan make:model Alumno</span>
<span class="linenos" data-linenos="2 "></span><span class="go">php artisan make:model Materia</span>
</code></pre></div>
<h4 id="2-crear-las-3-migraciones">2. Crear las 3 migraciones<a class="headerlink" href="#2-crear-las-3-migraciones" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan make:migration create_alumnos_table --create=alumnos</span>
<span class="linenos" data-linenos="2 "></span><span class="go">php artisan make:migration create_materias_table --create=materias</span>
<span class="linenos" data-linenos="3 "></span><span class="go">php artisan make:migration create_alumno_materia_table --create=alumno_materia</span>
</code></pre></div>
<h4 id="3-modificar-las-migraciones">3. Modificar las migraciones<a class="headerlink" href="#3-modificar-las-migraciones" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">create_alumnos_table.php</label><label for="__tabbed_1_2">create_materias_table.php</label><label for="__tabbed_1_3">create_alumno_materia_table.php</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;alumnos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">});</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;materias&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">});</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;alumno_materia&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">foreignId</span><span class="p">(</span><span class="s1">&#39;alumno_id&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 9 "></span>      <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span>      <span class="o">-&gt;</span><span class="na">constrained</span><span class="p">(</span><span class="s1">&#39;alumnos&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>      <span class="o">-&gt;</span><span class="na">cascadeOnUpdate</span><span class="p">()</span>
<span class="linenos" data-linenos="12 "></span>      <span class="o">-&gt;</span><span class="na">nullOnDelete</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">foreignId</span><span class="p">(</span><span class="s1">&#39;materia_id&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>      <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">()</span>
<span class="linenos" data-linenos="16 "></span>      <span class="o">-&gt;</span><span class="na">constrained</span><span class="p">(</span><span class="s1">&#39;materias&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>      <span class="o">-&gt;</span><span class="na">cascadeOnUpdate</span><span class="p">()</span>
<span class="linenos" data-linenos="18 "></span>      <span class="o">-&gt;</span><span class="na">nullOnDelete</span><span class="p">();</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos="21 "></span>  <span class="p">});</span>
<span class="linenos" data-linenos="22 "></span><span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h4 id="4-ejecutar-las-migraciones">4. Ejecutar las migraciones<a class="headerlink" href="#4-ejecutar-las-migraciones" title="Permanent link">&para;</a></h4>
<p>Lanzar las migraciones para que se creen las tablas en la BDD. Rellenar con alguna información de prueba.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan migrate</span>
</code></pre></div>
<h4 id="5-rellenar-la-bdd-con-datos-de-prueba">5. Rellenar la BDD con datos de prueba<a class="headerlink" href="#5-rellenar-la-bdd-con-datos-de-prueba" title="Permanent link">&para;</a></h4>
<p>Crear varios datos de prueba insertando por ejemplo, los siguientes registros mediante sentencias SQL.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Tabla Alumnos</label><label for="__tabbed_2_2">Tabla Materias</label><label for="__tabbed_2_3">Tabla Alumno_Materia</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">alumnos</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">nombre</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Antonio&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Laura&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Marta&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Pedro&#39;</span><span class="p">);</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">materias</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">nombre</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Programacion&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Interfaces&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;JavaScript&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Sistemas&#39;</span><span class="p">);</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">alumno_materia</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">alumno_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">materia_id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="linenos" data-linenos="6 "></span><span class="w">    </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span>
<span class="linenos" data-linenos="7 "></span><span class="w">    </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="linenos" data-linenos="8 "></span><span class="w">    </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="linenos" data-linenos="9 "></span><span class="w">    </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<h4 id="6-relacion-alumno-materia">6. Relación Alumno&lt;-&gt;Materia<a class="headerlink" href="#6-relacion-alumno-materia" title="Permanent link">&para;</a></h4>
<p>En otro tipo de relaciones se podía indicar la clave ajena, en esta se indica la tabla intermedia de la relación <code>alumno_materia</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Alumno.php</label><label for="__tabbed_3_2">Materia.php</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">materias</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Materia</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;alumno_materia&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">alumnos</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Alumno</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;alumno_materia&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h4 id="7-crear-las-rutas">7. Crear las rutas<a class="headerlink" href="#7-crear-las-rutas" title="Permanent link">&para;</a></h4>
<p>Vamos a crear las rutas para que dado el id de un alumno pasado por parámetro, devuelva un listado de sus asignaturas y viceversa.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">web.php</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>  <span class="k">use</span> <span class="nx">App\Http\Controllers\RelacionController</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>  <span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Route</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span>  <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;alumnos/{id}/materias&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">AlumnoController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;materias&#39;</span><span class="p">]);</span>
</code></pre></div>
</div>
</div>
</div>
<p>Haz tú la ruta, para que dado el id de una asignatura pasada por parámetro, devuelva un listado de los alumnos que la cursan.</p>
<h4 id="8-crear-el-controlador">8. Crear el controlador<a class="headerlink" href="#8-crear-el-controlador" title="Permanent link">&para;</a></h4>
<p>Necesitamos controladores para redireccionar las rutas a las vistas que nosotros queramos, para ello empezamos creando el controlador <code>AlumnoController</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan make:controller AlumnoController</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">AlumnoController.php</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>  <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>  <span class="k">use</span> <span class="nx">App\Models\Alumno</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>  <span class="k">class</span> <span class="nc">AlumnoController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">materias</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>      <span class="nv">$materias</span> <span class="o">=</span> <span class="nx">Alumno</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">materias</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>      <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;alumnos.materias&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;materias&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>  <span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Haz tú ahora el controlador <code>MateriaController</code> con su función correspondiente para devolver a los alumnos que cursen una materia determinada.</p>
<h4 id="9-crear-la-vista">9. Crear la vista<a class="headerlink" href="#9-crear-la-vista" title="Permanent link">&para;</a></h4>
<p>Vamos a crar la vista que liste las materias de un usuario. Para ello creamos el archivo <code>alumnos/materias.blade.php</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>```html
<span class="linenos" data-linenos=" 2 "></span>&lt;div class=&quot;row justify-content-center&quot;&gt;
<span class="linenos" data-linenos=" 3 "></span>  &lt;div class=&quot;col-auto&quot;&gt;
<span class="linenos" data-linenos=" 4 "></span>    &lt;h3&gt;Las materias que está cursando el alumno son:&lt;/h3&gt;
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    &lt;table class=&quot;table table-striped table-hover&quot;&gt;
<span class="linenos" data-linenos=" 7 "></span>      &lt;thead class=&quot;bg-primary text-white&quot;&gt;
<span class="linenos" data-linenos=" 8 "></span>        &lt;th&gt;MATERIAS&lt;/th&gt;
<span class="linenos" data-linenos=" 9 "></span>      &lt;/thead&gt;
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>      &lt;tbody&gt;
<span class="linenos" data-linenos="12 "></span>        @foreach ($materias as $materia)
<span class="linenos" data-linenos="13 "></span>          &lt;tr&gt;
<span class="linenos" data-linenos="14 "></span>            &lt;td&gt;
<span class="linenos" data-linenos="15 "></span>                {{ $materia-&gt;nombre }}
<span class="linenos" data-linenos="16 "></span>             &lt;/td&gt;
<span class="linenos" data-linenos="17 "></span>          &lt;/tr&gt;
<span class="linenos" data-linenos="18 "></span>        @endforeach
<span class="linenos" data-linenos="19 "></span>      &lt;/tbody&gt;
<span class="linenos" data-linenos="20 "></span>    &lt;/table&gt;
<span class="linenos" data-linenos="21 "></span>  &lt;/div&gt;
<span class="linenos" data-linenos="22 "></span>&lt;/div&gt;
<span class="linenos" data-linenos="23 "></span>```
</code></pre></div>
<p>¿Y si quisiéramos además dar información del propio alumno? Como su nombre por ejemplo, ¿qué más tendrías que pasar a la vista?</p>
<p>Haz tú ahora la vista correspondiente a los alumnos que cursan una determinada materia en el archivo <code>materias/alumnos.blade.php</code>.</p>
<h2 id="94-mutadores-y-accesores">9.4 Mutadores y accesores<a class="headerlink" href="#94-mutadores-y-accesores" title="Permanent link">&para;</a></h2>
<p>Los <strong>mutatores</strong> permiten transformar datos antes de guardarlos y los <strong>accesores</strong> los transforman al recuperarlos.</p>
<p>Ejemplo sobre el atributo <code>password</code> definido como <code>string</code> en la migración:</p>
<ul>
<li>El mutador (set) encripta la contraseña con bcrypt().</li>
<li>El accesor (get) devuelve "<strong><em>*</em></strong>*" para ocultar la contraseña al acceder al modelo.</li>
</ul>
<p>Y otro ejemplo más útil sobre el atributo <code>preferencias</code>, un array asociativo con el listado de preferencias del usuario. Como el tipo de dato <code>array</code> no existe, se define como <code>json</code> en la migración (también valdría <code>text</code>) y mediante el mutador y accesor lo transformamos:</p>
<ul>
<li>El mutador (set) trata el array asociativo de PHP como un objeto JSON que codifica a un string (listo para almacenar en la BDD).</li>
<li>El accesor (get) decodifica el string a un objeto JSON accesible como array asociativo de PHP.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Casts\Attribute</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// Atributo &#39;password&#39; para usar con mutador (set) y accesor (get)</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">password</span><span class="p">()</span><span class="o">:</span> <span class="nx">Attribute</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">return</span> <span class="nx">Attribute</span><span class="o">::</span><span class="na">make</span><span class="p">(</span>
<span class="linenos" data-linenos="11 "></span>            <span class="nx">get</span><span class="o">:</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;********&#39;</span><span class="p">,</span> <span class="c1">// Oculta la contraseña al acceder</span>
<span class="linenos" data-linenos="12 "></span>            <span class="nx">set</span><span class="o">:</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="nv">$value</span><span class="p">),</span> <span class="c1">// Encripta al guardar</span>
<span class="linenos" data-linenos="13 "></span>        <span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>    <span class="c1">// Atributo &#39;preferencias&#39; para usar con mutador (set) y accesor (get)</span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">preferencias</span><span class="p">()</span><span class="o">:</span> <span class="nx">Attribute</span><span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>      <span class="k">return</span> <span class="nx">Attribute</span><span class="o">::</span><span class="na">make</span><span class="p">(</span>
<span class="linenos" data-linenos="20 "></span>          <span class="nx">get</span><span class="o">:</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// Accesor: Devuelve preferencias como array PHP (true para indicar que es asociativo)</span>
<span class="linenos" data-linenos="21 "></span>          <span class="nx">set</span><span class="o">:</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nx">JSON_UNESCAPED_UNICODE</span><span class="p">),</span>  <span class="c1">// Mutador: Transforma el array de preferencias a objeto JSON que almacena como string</span>
<span class="linenos" data-linenos="22 "></span>      <span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="p">}</span>
</code></pre></div>
<p>Uso:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">// Establecemos la contraseña (Laravel la encripta automáticamente)</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;mi_contraseña_segura&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">;</span> <span class="c1">// Salida: ******** (accesor oculta el valor)</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// Internamente &#39;preferencias&#39; guarda un JSON o string, pero se le asigna o recupera un array asociativo</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">preferencias</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tema&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;claro&quot;</span><span class="p">,</span> <span class="s2">&quot;idioma&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;ES&quot;</span><span class="p">,</span> <span class="s2">&quot;mobile&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">];</span>
<span class="linenos" data-linenos="10 "></span><span class="nx">dd</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">preferencias</span><span class="p">);</span> 
<span class="linenos" data-linenos="11 "></span><span class="cm">/* Salida: array:4 [▼ </span>
<span class="linenos" data-linenos="12 "></span><span class="cm">  &quot;tema&quot; =&gt; &quot;claro&quot;</span>
<span class="linenos" data-linenos="13 "></span><span class="cm">  &quot;idioma&quot; =&gt; &quot;ES&quot;</span>
<span class="linenos" data-linenos="14 "></span><span class="cm">  &quot;mobile&quot; =&gt; true</span>
<span class="linenos" data-linenos="15 "></span><span class="cm">  &quot;size&quot; =&gt; 12</span>
<span class="linenos" data-linenos="16 "></span><span class="cm">]</span>
<span class="linenos" data-linenos="17 "></span><span class="cm">*/</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="c1">// Verificamos en la base de datos</span>
<span class="linenos" data-linenos="22 "></span><span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAttributes</span><span class="p">()[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span> <span class="c1">// Salida del hash sin modificar: $2y$10$...</span>
<span class="linenos" data-linenos="23 "></span><span class="nx">dd</span><span class="p">(</span><span class="nv">$alumno</span><span class="o">-&gt;</span><span class="na">getAttributes</span><span class="p">()[</span><span class="s1">&#39;preferencias&#39;</span><span class="p">]);</span> <span class="c1">// Salida como texto sin transformar: &quot;{&quot;tema&quot;:&quot;claro&quot;,&quot;idioma&quot;:&quot;ES&quot;,&quot;mobile&quot;:true,&quot;size&quot;:12}&quot; </span>
</code></pre></div>
<p>Más info en <a href="https://laravel.com/docs/11.x/eloquent-mutators#defining-an-accessor">mutadores y accesores</a>.</p>
<h2 id="95-seeders-y-factorias">9.5 Seeders y factorías<a class="headerlink" href="#95-seeders-y-factorias" title="Permanent link">&para;</a></h2>
<p>Los seeders y factorías permiten generar datos de prueba de forma fácil y rápida, útiles durante el desarrollo para simular datos iniciales en una aplicación.</p>
<h3 id="seeders">Seeders<a class="headerlink" href="#seeders" title="Permanent link">&para;</a></h3>
<p>Los seeders son clases especiales que permiten "sembrar" datos en la base de datos.</p>
<h4 id="crear-un-seeder">Crear un seeder<a class="headerlink" href="#crear-un-seeder" title="Permanent link">&para;</a></h4>
<p>Mediante el siguiente comando crearmos un seeder con nombre <code>BooksSeeder</code> en el directorio <em>database/seeders</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan make:seeder BooksSeeder</span>
</code></pre></div>
<p>En el método <code>run</code> añadimos los elementos que queremos crear:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">BooksSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="c1">// Ejemplo: Crear un libro</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">();</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s2">&quot;Laravel for Beginners&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">author</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="anadir-el-seeder-a-databaseseeder">Añadir el seeder a DatabaseSeeder<a class="headerlink" href="#anadir-el-seeder-a-databaseseeder" title="Permanent link">&para;</a></h4>
<p>El seeder recién creado hay que añadirlo al <code>DatabaseSeeder</code>. Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
<span class="linenos" data-linenos=" 7 "></span>            <span class="nx">BooksSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>            <span class="nx">AuthorsSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="c1">// ...</span>
<span class="linenos" data-linenos="10 "></span>        <span class="p">]);</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="ejecutar-el-seeder">Ejecutar el seeder<a class="headerlink" href="#ejecutar-el-seeder" title="Permanent link">&para;</a></h4>
<p>Podemos hacer varias cosas, según nos interese:</p>
<ul>
<li><code>php artisan db:seed</code> : Ejecutar todos los seeders.</li>
<li><code>php artisan db:seed --class=BooksSeeder</code> : Ejecutar un seeder escífico.</li>
<li><code>php artisan migrate:fresh --seed</code> : Reiniciar las migraciones y ejecutar todos los seeders.</li>
</ul>
<h3 id="factorias">Factorías<a class="headerlink" href="#factorias" title="Permanent link">&para;</a></h3>
<p>Las factorías permiten crear grandes cantidades de datos "fake" de forma rápida y dinámica. Utiliza la librería <a href="https://fakerphp.org/">Faker</a> para ello.</p>
<h4 id="crear-una-factoria">Crear una factoría<a class="headerlink" href="#crear-una-factoria" title="Permanent link">&para;</a></h4>
<p>Mediante el siguiente comando creamos una factoría con nombre <code>AuthorFactory</code> asociada al modelo <code>Author</code> en el directorio <em>database/factories</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">php artisan make:factory AuthorFactory -m Author</span>
</code></pre></div>
<p>En el método <code>definition</code> devolvemos un array asociativo con los campos del objeto que queremos crear. Cada campo lo creamos mediante <code>fake()</code> o también <code>$this-&gt;faker</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Database\Factories</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">App\Models\Author</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\Factory</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">AuthorFactory</span> <span class="k">extends</span> <span class="nx">Factory</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="c1">// Asociación de la factoría con el modelo (en este caso se podría omitir porque Laravel la deduce por el nombre)</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">protected</span> <span class="nv">$model</span> <span class="o">=</span> <span class="nx">Author</span><span class="o">::</span><span class="na">class</span><span class="p">;</span> 
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">definition</span><span class="p">()</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos="15 "></span>            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span>            <span class="s1">&#39;birth_year&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span>            <span class="c1">// &#39;name&#39; =&gt; $this-&gt;faker-&gt;name, // equivalente a fake()</span>
<span class="linenos" data-linenos="18 "></span>            <span class="c1">// &#39;birth_year&#39; =&gt; $this-&gt;faker-&gt;year, // equivalente a fake()</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">];</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span><span class="p">}</span>
</code></pre></div>
<p>En modelos relacionados (<em>1a1</em> o <em>1aM</em>) lo más sencillo es llamar a la factoría directamente en el campo de la relación (en los <em>MaM</em> se utiliza has<em>Model</em> y se ve más abajo):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Database\Factories</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">App\Models\Author</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\Factory</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">BookFactory</span> <span class="k">extends</span> <span class="nx">Factory</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">definition</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos="12 "></span>            <span class="s1">&#39;isbn&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isbn13</span><span class="p">(),</span> <span class="c1">// Crea un ISBN de 13 dígitos (formato actual)</span>
<span class="linenos" data-linenos="13 "></span>            <span class="s1">&#39;titulo&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">sentence</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="c1">// Genera un título de 5 palabras</span>
<span class="linenos" data-linenos="14 "></span>            <span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span> <span class="c1">// Crea un autor y lo relaciona con el libro por el campo author_id que existe en book</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">];</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="asociar-factoria-al-modelo">Asociar factoría al modelo<a class="headerlink" href="#asociar-factoria-al-modelo" title="Permanent link">&para;</a></h4>
<p>Hay que asociar la factoría con el modelo tanto en la factoría como en el modelo.</p>
<ul>
<li>En la <strong>parte de la factoría</strong> se realiza con convención, por lo que si la factoría se llama AuthorFactory, el modelo asociado será Author. Y en caso de que queramos indicar esta asociación de forma explícita, lo podemos hacer a través de la propiedad <code>$model</code> como en el ejemplo anterior.</li>
<li>En la <strong>parte del modelo</strong>, si lo hemos creamos a mano, hay que indicar que usa una factoría mediante el <a href="https://www.php.net/manual/en/language.oop5.traits.php">trait</a> <code>HasFactory</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">class</span> <span class="nc">Author</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos="6 "></span><span class="p">{</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span>    <span class="c1">//...  </span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="utilizar-una-factoria">Utilizar una factoría<a class="headerlink" href="#utilizar-una-factoria" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Donde nos interese, por ejemplo en el controlador, modelo... pero lo ideal es en un seeder</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">App\Models\Author</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">// Crear un autor</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// Crear 10 autores</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">// También crea 10 autores</span>
<span class="linenos" data-linenos="11 "></span><span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="c1">// Crea 10 autores con 3 libros para cada uno (también para relaciones M a M)</span>
<span class="linenos" data-linenos="14 "></span><span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span>
<span class="linenos" data-linenos="15 "></span>    <span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> 
<span class="linenos" data-linenos="16 "></span>    <span class="o">-&gt;</span><span class="na">hasBooks</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 
<span class="linenos" data-linenos="17 "></span>    <span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
</code></pre></div>
<h4 id="integracion-con-seeders">Integración con seeders<a class="headerlink" href="#integracion-con-seeders" title="Permanent link">&para;</a></h4>
<p>Combinando factorías con seeders se pueden crear datos dinámicos de forma sencilla. No olvidar incluir los seeders en <code>DatabaseSeeder</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">AuthorsSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1">// Utilizar factorías con datos relacionados</span>
<span class="linenos" data-linenos="11 "></span><span class="k">class</span> <span class="nc">BooksSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="linenos" data-linenos="12 "></span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$authors</span> <span class="o">=</span> <span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$authors</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$author</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nx">Book</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$author</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">});</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span><span class="p">}</span>
</code></pre></div>
<p>Opción más sencilla para <strong>crear en el mismo seeder autores y libros relacionados</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">AuthorsSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nx">Author</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span>            <span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// Crea 10 autores</span>
<span class="linenos" data-linenos=" 8 "></span>            <span class="o">-&gt;</span><span class="na">hasBooks</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// Para cada autor crea 3 libros relacionados</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="96-resumen">9.6 Resumen<a class="headerlink" href="#96-resumen" title="Permanent link">&para;</a></h2>
<p>En este tema de <strong>Laravel Avanzado</strong>, se profundiza en las capacidades del <em>framework</em> para el manejo de archivos, relaciones complejas y automatización de datos. </p>
<h3 id="i-manejo-de-ficheros-91">I. Manejo de Ficheros (9.1)<a class="headerlink" href="#i-manejo-de-ficheros-91" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Sistema Flysystem:</strong> Laravel utiliza una API uniforme para interactuar con archivos locales o en la nube (Amazon S3) a través de la configuración en <code>config/filesystems.php</code>.</li>
<li><strong>Almacenamiento:</strong> Se utiliza la fachada <strong><code>Storage</code></strong> para operaciones como <code>put</code>, <code>get</code>, <code>delete</code> y <code>download</code>. </li>
<li><strong>Enlace Simbólico:</strong> Para que los archivos en <code>storage/app/public</code> sean accesibles desde el navegador, es imprescindible ejecutar <strong><code>php artisan storage:link</code></strong>, lo que crea un acceso en la carpeta <code>public</code>.</li>
</ul>
<h3 id="ii-request-y-response-92">II. Request y Response (9.2)<a class="headerlink" href="#ii-request-y-response-92" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Request:</strong> La clase <code>Illuminate\Http\Request</code> permite interactuar con la solicitud HTTP de forma orientada a objetos, facilitando el acceso a inputs (<code>all()</code>, <code>input()</code>), parámetros de ruta y archivos enviados (<code>hasFile()</code>, <code>file()</code>).</li>
<li><strong>Response:</strong> Permite personalizar la respuesta al cliente, incluyendo códigos de estado, <strong>respuestas JSON</strong> (comunes en APIs), redirecciones con datos de sesión (<code>with()</code>) y manipulación de cabeceras HTTP.</li>
</ul>
<h3 id="iii-eloquent-relaciones-93">III. Eloquent: Relaciones (9.3)<a class="headerlink" href="#iii-eloquent-relaciones-93" title="Permanent link">&para;</a></h3>
<p>Eloquent permite gestionar las conexiones entre tablas mediante métodos en los modelos, evitando escribir SQL manual.</p>
<ul>
<li><strong>Tipos de Relaciones:</strong> <ul>
<li><strong>Uno a Uno:</strong> <code>hasOne()</code> y su inversa <code>belongsTo()</code>.</li>
<li><strong>Uno a Muchos:</strong> <code>hasMany()</code> y su inversa <code>belongsTo()</code>.</li>
<li><strong>Muchos a Muchos:</strong> Requiere una <strong>tabla pivote</strong>. Se define con <code>belongsToMany()</code> en ambos modelos.</li>
<li><strong>Transitivas:</strong> <code>hasManyThrough()</code> permite acceder a tablas lejanas a través de una intermedia.</li>
</ul>
</li>
<li><strong>Gestión de Pivotes:</strong> Para relaciones muchos a muchos, existen métodos para gestionar la tabla intermedia: <strong><code>attach()</code></strong> (añadir), <strong><code>detach()</code></strong> (quitar), <strong><code>sync()</code></strong> (sincronizar una lista exacta) y <strong><code>toggle()</code></strong> (alternar existencia).</li>
</ul>
<h3 id="iv-mutadores-y-accesores-94">IV. Mutadores y Accesores (9.4)<a class="headerlink" href="#iv-mutadores-y-accesores-94" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Mutadores (set):</strong> Permiten transformar o formatear los datos automáticamente <em>antes</em> de guardarlos en la base de datos (ej. encriptar una contraseña o convertir un array a JSON).</li>
<li><strong>Accesores (get):</strong> Transforman los datos al ser recuperados del modelo (ej. mostrar una fecha en un formato específico o decodificar un JSON). Se implementan mediante la clase <code>Attribute::make()</code>.</li>
</ul>
<h3 id="v-seeders-y-factorias-95">V. Seeders y Factorías (9.5)<a class="headerlink" href="#v-seeders-y-factorias-95" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Seeders:</strong> Clases para "sembrar" la base de datos con registros iniciales o de prueba. Se ejecutan con <code>php artisan db:seed</code>.</li>
<li><strong>Factorías:</strong> Utilizan la librería <strong>Faker</strong> para generar grandes volúmenes de datos aleatorios de forma dinámica.</li>
<li><strong>Integración:</strong> Lo ideal es llamar a las factorías dentro de los <em>seeders</em> para automatizar la creación de modelos relacionados (ej. crear un Autor que automáticamente tenga 3 Libros asociados).</li>
</ul>
<h2 id="97-actividades">9.7 Actividades<a class="headerlink" href="#97-actividades" title="Permanent link">&para;</a></h2>
<p>A continuación, vas a realizar una serie de ejercicios sobre cada uno de los apartados vistos en el tema. Puedes crear un proyecto nuevo o reutilizar uno existente.</p>
<h3 id="manejo-de-ficheros">Manejo de ficheros<a class="headerlink" href="#manejo-de-ficheros" title="Permanent link">&para;</a></h3>
<p>Para practicar con los ficheros vas a crear una galería de imágenes con posibilidad de subir nuevas, eliminar y acceder a su vista en detalle. También vas a implementar un "Mini Drive" para gestionar archivos. En ambos casos, vas a trabajar sin modelos para centrarte exclusivamente en el manejo de ficheros, pero en una app real, además sería recomendable trabajar con una BDD que almacene la información necesaria de los archivos.</p>
<ol start="901">
<li>
<p><strong>Formulario de subida</strong>: Crea un formulario para subir una imagen. La ruta que lleva al formulario por GET será <code>imagen/create</code> y la vista del mismo será <code>imagen/create.blade.php</code>. El formulario se enviará por POST a la ruta <code>imagen/storage</code>. Además del propio input de la imagen, el formulario tendrá un radio button para seleccionar si la imagen se almacenará de forma privada o pública en el storage.</p>
</li>
<li>
<p><strong>Almacenar archivos</strong>: Crea la función correspondiente en el controlador para recibir la imagen del formulario anterior validando que sea del tipo imagen, requerida y con un tamaño máximo de 2MB. Y según la opción del formulario, almacena la imagen de forma privada o pública en el storage. Después redirecciona a la página anterior enviando un mensaje del tipo "Imagen NOMBRE almacenada correctamente en el storage privado|público" que mostrarás justo encima del formulario.</p>
</li>
<li>
<p><strong>Mostrar archivos</strong>: Mediante la ruta por GET <code>imagen</code> que lleva a la vista <code>imagen/index.blade.php</code> muestra una galería con todas las imágenes en miniatura. Puedes utilizar flexbox o grid layout para posicionarlas unas al lado de las otras. <strong>Importante</strong>: No olvides crear el enlace simbólico para poder acceder a las imágenes. Crea un enlace "Subir imagen" que lleve al formulario del primer punto y en dicho formulario, un enlace para volver aquí, al listado.</p>
</li>
<li>
<p><strong>Mostrar imagen completa</strong>: Mediante la ruta por GET <code>imagen/{name}</code> que lleva a la vista <code>imagen/show.blade.php</code> muestra la vista en tamaño completo de la imagen. Muestra un párrafo con su ruta completa y un enlace para volver al listado.</p>
</li>
<li>
<p><strong>Eliminar archivos</strong>: Mediante la ruta por GET <code>imagen/{name}/destroy</code> elimina la imagen que corresponda. A esta ruta podrás llegar mediante un enlace de la vista en detalle de la imagen. Una vez eliminada, se redirige automáticamente al listado enviando con 'with' un mensaje del tipo "Imagen NOMBRE eliminada correctamente del storage público". Si lo prefieres, en lugar del enlace a eliminar, puedes hacerlo mediante un formulario que lleve a una ruta DELETE <code>imagen/{name}</code>.</p>
</li>
<li>
<p><strong>Almacenamiento en S3</strong> (opcional): Con tu cuenta de estudiante de AWS, crea un bucket S3 con acceso público. Configura el proyecto actual para utilizar el disco 's3' por defecto o bien utilízalo de forma explícita en cada interacciíon que realices con el Storage.</p>
</li>
<li>
<p><strong>Mini Drive</strong>: De forma similar a lo que acabas de hacer con la galería, crea un sistema de almecenamiento de archivos que admita archivos de diferente tipo (imágenes, videos, documentos...). Deberás mostrar un listado con un icono según el tipo de archivo, su nombre, tamaño y opciones (eliminar), un formulario para subirlo con un campo en el que recojas el nombre con el que almacenarlo. Y en vez de la vista en detalle, al pulsar sobre el archivo en la vista del listado, se descargará directamente. Sigue las recomendaciones de los puntos anteriores. Recuerda que cada archivo no va a tener un modelo asociado, por lo que el nombre, tamaño... deberás obtenerlo de la información del propio archivo.</p>
</li>
<li>
<p><strong>Mini Drive con directorios</strong> (opcional): Investiga cómo crear directorios y mover archivos entre ellos. Ofrece en la interfaz que has creado, las opciones correspondientes para crear un nuevo directorio, para cambiar el nobmre a un archivo (si no existe uno ya con dicho nombre) y moverlo a un directorio determinado. </p>
</li>
</ol>
<h3 id="request-y-response">Request y response<a class="headerlink" href="#request-y-response" title="Permanent link">&para;</a></h3>
<p>En los siguientes ejercicios vas a trabajar con <code>Request</code>y <code>Response</code> en las funciones de los controladores. El primero ya lo has utilizado para recoger los datos recibidos de un formulario. Vas a repasar su uso y sobre todo, vas a conocer el segundo.</p>
<ol start="910">
<li>
<p><strong>Obtener y validar datos con Request</strong>: Crea un pequeño formulario para recoger "Nombre" y "Email" del usuario. Recoge sus datos en una función del controlador y valídalos. Si pasan la validación, símplemente devuelve un mensaje "Se ha pasado la validación" y si no, captura los errores en la vista del formulario.</p>
</li>
<li>
<p><strong>Redireccionar la respuesta</strong>: Modifica el ejercicio anterior para redireccionar la respuesta a otra ruta.</p>
</li>
<li>
<p><strong>Respuesta JSON</strong>: Crea una ruta GET <code>/api/usuarios</code> que devuelva un array de usuarios (id, nombre, email) en formato JSON.</p>
</li>
<li>
<p><strong>Respuesta JSON error</strong>: Crea una ruta GET <code>/api/error</code> que devuelva un array (error y mensaje) en formato JSON y además, el código de estado 400 para indicar al cliente que ha enviado una petición inválida.</p>
</li>
<li>
<p><strong>Modificar cabeceras de la respuesta</strong>: Crea una ruta GET <code>/archivo/descargar</code> que devuelva un archivo descargable y modifique los encabezados de la respuesta. En el controlador, usa <em>response()-&gt;download()</em> para devolver el archivo estableciendo un encabezado personalizado.</p>
</li>
<li>
<p><strong>Ejercicio completo: API Rest</strong>: Con lo visto hasta ahora, implementa una API RESTful para manejar usuarios:</p>
</li>
</ol>
<ul>
<li><strong>C</strong>: Crear un usuario mediante POST <code>/api/usuarios</code>.</li>
<li><strong>R</strong>: Listar usuarios con GET <code>/api/usuarios</code>.</li>
<li><strong>U</strong>: Actualizar un usuario con PUT <code>/api/usuarios/{id}</code>.</li>
<li><strong>D</strong>: Eliminar un usuario con DELETE <code>/api/usuarios/{id}</code>.</li>
</ul>
<p>Asegúrate de devolver respuestas adecuadas en JSON y manejar los errores correctamente.</p>
<h3 id="eloquent-relaciones">Eloquent: Relaciones<a class="headerlink" href="#eloquent-relaciones" title="Permanent link">&para;</a></h3>
<p>En este apartado vas a crear diferentes relaciones entre modelos.</p>
<ol start="920">
<li><strong>Relación 1 a 1</strong>. </li>
</ol>
<ul>
<li>Crea los modelos <code>Usuario</code> y <code>Perfil</code>. Cada usuario tiene un perfil, y cada perfil pertenece a un único usuario.</li>
<li>En las migraciones asegúrate que las tablas tienen los siguientes campos:</li>
<li><code>usuarios</code>: campos <code>id</code>, <code>nombre</code>, <code>email</code>.</li>
<li><code>perfiles</code>: campos <code>id</code>, <code>usuario_id</code> (clave foránea), <code>telefono</code>, <code>direccion</code>.</li>
<li>Define la relación en los modelos.</li>
<li>Rellena con 2 ó 3 registros manualmente o mediante Eloquent en ambas tablas/modelos.</li>
<li>Consulta los datos de un usuario y muestra su perfil. Para ello, crea una ruta <code>usuario/{id}</code> que redirija a la función <code>show</code> del controlador y llame a la vista <code>usuario.show.blade.php</code> para los datos del usuario con su perfil.</li>
</ul>
<ol start="921">
<li><strong>Relación 1 a Muchos</strong>. </li>
</ol>
<ul>
<li>Crea los modelos <code>Categoria</code> y <code>Producto</code>. Cada categoría tiene muchos productos, pero un producto sólo perteneca una determinada categoría.</li>
<li>En las migraciones asegúrate que las tablas tienen los siguientes campos:</li>
<li><code>categorias</code>: campos <code>id</code>, <code>nombre</code>.</li>
<li><code>productos</code>: campos <code>id</code>, <code>nombre</code>, <code>categoria_id</code> (clave foránea).</li>
<li>Define la relación en los modelos.</li>
<li>Rellena con 2 ó 3 registros manualmente o mediante Eloquent en ambas tablas/modelos.</li>
<li>Consulta el nombre de una categoría mostrando sus productos. Para ello, crea una ruta <code>categoria/{id}</code> que redirija a la función <code>show</code> del controlador y llame a la vista <code>categoria.show.blade.php</code>.</li>
<li>Mediante Eloquent agrega un nuevo producto a la categoría con id pasado por parámetro. Para ello, crea una ruta <code>categoria/{id}/addproduct/{nombre}</code> que redirija a la función <code>addProduct</code> del controlador y redirija a la ruta <code>show</code> anterior que llama a la vista <code>categoria.show.blade.php</code>.</li>
</ul>
<ol start="922">
<li><strong>Relación Muchos a Muchos</strong>. </li>
</ol>
<ul>
<li>Crea los modelos <code>Estudiante</code> y <code>Asignatura</code>. Cada estudiante puede estár matriculado en muchas asignaturas y una asignatura la cursan muchos estudiantes.</li>
<li>En las migraciones asegúrate que las tablas tienen los siguientes campos:</li>
<li><code>estudiantes</code>: campos <code>id</code>, <code>nombre</code>.</li>
<li><code>asignaturas</code>: campos <code>id</code>, <code>nombre</code>.</li>
<li><code>asignatura_estudiante</code> (tabla pivote): <code>estudiante_id</code>, <code>asignatura_id</code>.</li>
<li>Define la relación en los modelos.</li>
<li>Rellena con 2 ó 3 registros manualmente o mediante Eloquent en ambas tablas/modelos.</li>
<li>Consulta todas las asignaturas de un estudiante por su id. Para ello, crea una ruta <code>estudiante/{id}</code> que redirija a la función <code>show</code> del controlador y llame a la vista <code>estudiante.show.blade.php</code>.</li>
<li>Consulta ahora todos los estudiantes que cursen una asignatura por su id. Para ello, crea una ruta <code>asignatura/{id}</code> que redirija a la función <code>show</code> del controlador y llame a la vista <code>asignatura.show.blade.php</code>.</li>
<li>Mediante Eloquent matricula a un estudiante en un curso determinado. Para ello, crea una ruta <code>estudiante/{id}/matricula/{idCurso}</code> que redirija a la función <code>matricula</code> del controlador y redirija a la ruta <code>show</code> de estudiante que llama a la vista <code>estudiante.show.blade.php</code>.</li>
<li>Mediante Eloquent desmatricula a un estudiante en un curso determinado. Para ello, crea una ruta <code>estudiante/{id}/desmatricula/{idCurso}</code> que redirija a la función <code>desmatricula</code> del controlador y redirija a la ruta <code>show</code> de estudiante que llama a la vista <code>estudiante.show.blade.php</code>.</li>
</ul>
<ol start="923">
<li><strong>Ejercicio completo</strong>: CRUD con varias relaciones y formularios.</li>
</ol>
<ul>
<li>Implementa un sistema de gestión de posts con sus respectivos comentarios mediante los modelos <code>Autor</code>, <code>Post</code> y <code>Comentario</code>.</li>
<li>Piensa bien las relaciones a utilizar. Un autor puede escribir muchos posts y comentarios. Un post puede tener muchos comentarios. Un comentario sólo pertenece a un post y está escrito por un autor.</li>
<li>De un <em>autor</em> interesa saber su imagen, nombre y email.</li>
<li>De un <em>post</em> interesa saber su título, fecha y descripción.</li>
<li>De un <em>comentario</em> interesa saber su texto y fecha.</li>
<li>Crea los CRUDs necesarios para cada modelo con sus rutas específicas, controladores, vistas (con formularios)...</li>
</ul>
<h3 id="mutadores-y-accesores">Mutadores y accesores<a class="headerlink" href="#mutadores-y-accesores" title="Permanent link">&para;</a></h3>
<ol start="930">
<li><strong>Formatear nombres y convertir números</strong>: En el modelo <code>Producto</code> del ejercicio anterior, crea:</li>
</ol>
<ul>
<li>Un mutador que almacene el nombre en minúsculas y un accesor que los devuelva con la primera letra en mayúscula.</li>
<li>Un mutador que almacene el precio convertido a céntimos y un accesor que lo devuelva de nuevo en euros.</li>
</ul>
<ol start="931">
<li><strong>Slug automático</strong>: Un slug es una versión formateada de un texto, generalmente usada en URLs por gestores de contenidos. Un slug se crea eliminando caracteres especiales, convirtiendo espacios en guiones y pasando a minúsculas el texto. Por ejemplo: "Hola Mundo Laravel" tendría de slug "hola-mundo-laravel".</li>
</ol>
<p>En el modelo <code>Post</code> del ejercicio anterior:</p>
<ul>
<li>Crea la migración correspondiente para añadir el campo <code>slug</code> de tipo string.</li>
<li>Investiga cómo usar <code>Str::slug</code> para generar slugs.</li>
<li>Crea un mutador que convierta el título a slug y lo almacene en el campo <code>slug</code>.</li>
</ul>
<ol start="932">
<li><strong>Formatear fechas de creación</strong>: En el modelo <code>Estudiante</code> del ejercicio anterior:</li>
</ol>
<ul>
<li>Investiga cómo usar la biblioteca <code>Carbon</code> para trabajar con fechas incluida en Laravel.</li>
<li>Crea un accesor que formatee la fecha de creación (created_at) en formato "d/m/Y - H:i".</li>
</ul>
<h3 id="seeders-y-factories">Seeders y factories<a class="headerlink" href="#seeders-y-factories" title="Permanent link">&para;</a></h3>
<ol start="940">
<li>
<p><strong>Seeder básico</strong>: Crea un nuevo modelo <code>Usuario</code> con campos <code>nombre</code>, <code>email</code> y <code>password</code> (en su migración) y crea un seeder <code>UsuarioSeeder</code> que inserte 3 usuarios de prueba en la base de datos.</p>
</li>
<li>
<p><strong>Factoría con seeder</strong>: Crea una factoría <code>UsuarioFactory</code> con datos fake y en el seeder <code>UsuarioSeeder</code> crea 10 usuarios mediante la factoría.</p>
</li>
<li>
<p><strong>Seeders con modelos relacionados</strong>: Crea el modelo <code>Publicacion</code> con los campos <code>titulo</code>, <code>contenido</code> y <code>usuario_id</code> (en su migración) y modifica los modelos para que un usuario se relacione con muchas publicaciones. Crea las factorías <code>UsuarioFactory</code> (ya la tienes) y <code>PublicacionFactory</code> con datos fake para utilizar en el seeder <code>UsuarioPublicacionSeeder</code> para crear 10 usuarios que tentan entre 1 y 5 publicaciones cada uno.</p>
</li>
</ol>
<h3 id="practica-directorio-trabajadores">Práctica: Directorio trabajadores<a class="headerlink" href="#practica-directorio-trabajadores" title="Permanent link">&para;</a></h3>
<p>Desarrolla una app que muestre a los trabajadores de una empresa con sus datos de contacto. Se incorporará un buscador que filtrará por varios de los campos y se darán opciones de ordenación.</p>
<p>A continuación se detallan los requisitos. Deberás hacer las migraciones correspondientes, rutas, controlador, vistas... que necesites para su implementación.</p>
<h4 id="requisitos">Requisitos<a class="headerlink" href="#requisitos" title="Permanent link">&para;</a></h4>
<ol>
<li>Modelo Trabajador con los siguientes campos:</li>
</ol>
<ul>
<li><em>nombre</em> (string): Nombre del trabajador.</li>
<li><em>apellidos</em> (string): Apellidos del trabajador.</li>
<li><em>telefono</em> (string): Teléfono profesional.</li>
<li><em>email</em> (string): Correo electrónico.</li>
<li><em>foto</em> (string): Nombre de la imagen del trabajador.</li>
<li><em>departamento</em> (string): Departamento al que pertenece (Ejemplo: Copmras, Ventas, RRHH, I+D...).</li>
<li><em>cargos</em> (array): Array de strings con los cargos del empleado (Ejemplo: Jefe departamento, coordinador área, director...).</li>
<li><em>fecha_nacimiento</em> (date): Fecha nacimiento.</li>
<li><em>sustituto</em> (boolean): Indica si está sustituyendo a otro trabajador.</li>
<li><em>mayor55</em> (boolean): Indica si es mayor de 55 años.</li>
</ul>
<ol start="2">
<li>Funciones CRUD:</li>
</ol>
<ul>
<li>Crear nuevos trabajadores.</li>
<li>Editar y actualizar trabajadores existentes.</li>
<li>Eliminar trabajadores.</li>
<li>Listar todos los trabajadores con opciones de búsqueda filtrado.</li>
</ul>
<ol start="3">
<li>Vistas con Blade:</li>
</ol>
<ul>
<li>Listado de trabajadores, con búsqueda y filtros por nombre, apellidos, departamento, cargos y si son o no sustitutos o mayortes de 55 años.</li>
<li>Formulario para añadir trabajadores.</li>
<li>Formulario para editar trabajadores.</li>
<li>Vista de detalle de un trabajador con toda su información.</li>
</ul>
<ol start="4">
<li>Extras opcionales:</li>
</ol>
<ul>
<li>Ordenar los trabajadores por fecha de nacimiento (más recientes primero).</li>
<li>Destacar el trabajador que cumpla años en el día de hoy poniéndole por ejemplo un icono de churros al lado del nombre para la invitación... 😜</li>
</ul>
<h3 id="practica-guiada-guia-de-equipos-de-futbol-femenino">Práctica guiada: Guía de equipos de fútbol femenino<a class="headerlink" href="#practica-guiada-guia-de-equipos-de-futbol-femenino" title="Permanent link">&para;</a></h3>
<p>El objetivo de este ejercicio es extender la Guía de Equipos de Fútbol Femenino para utilizar una base de datos relacional. Crearás tablas con migraciones, modelos para gestionar los datos y a integrarlos con controladores y vistas.</p>
<h4 id="paso-1-migracion">Paso 1: Migración<a class="headerlink" href="#paso-1-migracion" title="Permanent link">&para;</a></h4>
<p>Mediante una migración se va a crear la tabla <code>equipos</code> con la siguiente estructura:</p>
<ul>
<li><code>id</code>: Clave primaria, autoincremental.</li>
<li><code>nombre</code>: Nombre del equipo (cadena, único, obligatorio).</li>
<li><code>estadio</code>: Nombre del estadio del equipo (cadena, obligatorio).</li>
<li><code>titulos</code>: Número de títulos ganados (entero, predeterminado 0).</li>
<li><code>created_at</code> y <code>updated_at</code>: Campos de timestamps generados automáticamente.</li>
</ul>
<ol>
<li>Ejecuta:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>create_equipos_table<span class="w"> </span>--create<span class="o">=</span>equipos
</code></pre></div>
<ol start="2">
<li>Modifica el archivo de la migración para incluir la estructura pedida:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;estadio&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;titulos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">default</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">});</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<ol start="3">
<li>Ejecuta la migración para crear la tabla:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<h4 id="paso-2-modelo-y-seeder">Paso 2: Modelo y seeder<a class="headerlink" href="#paso-2-modelo-y-seeder" title="Permanent link">&para;</a></h4>
<p>Seguimos con la creación del modelo <code>Equipo</code> y el seeder <code>EquiposSeeder</code>. </p>
<ol>
<li>Crear el modelo asociado a la tabla anterior.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Equipo
</code></pre></div>
<ol start="2">
<li>Modifica el modelo <code>Equipo</code> en <code>app/Models/Equipo.php</code> para definir en <code>$fillable</code> los campos que se pueden rellenar mediante asignación masiva y opcionalmente la tabla a la que hace referencia el modelo (no es necesario, pero así repasas):</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="3 "></span><span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;equipos&#39;</span><span class="p">;</span> <span class="c1">// Aquí no es necesario porque Laravel la deduce por el nombre del modelo y la tabla</span>
</code></pre></div>
<ol start="3">
<li>Crea un seeder para la tabla <code>equipos</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:seeder<span class="w"> </span>EquiposSeeder
</code></pre></div>
<ol start="4">
<li>Modifica el seeder <code>EquiposSeeder</code> para generar los datos de ejemplo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Barcelona&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Camp Nou&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">],</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Real Madrid&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Santiago Bernabeu&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">],</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sevilla&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Ramón Sánchez Pizjuán&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="p">],</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Valencia&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mestalla&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">],</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Atlético de Madrid&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Wanda Metropolitano&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">],</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<ol start="5">
<li>Añade el seeder <code>EquiposSeeder</code> a la función <code>run</code> de <code>DatabaseSeeder</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
<span class="linenos" data-linenos="5 "></span>        <span class="nx">EquiposSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="6 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<ol start="6">
<li>Ejecuta los seeders para rellenar la tabla <code>equipos</code> con los datos de ejemplo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>db:seed
</code></pre></div>
<h4 id="paso-3-controladores-y-crud">Paso 3: Controladores y CRUD<a class="headerlink" href="#paso-3-controladores-y-crud" title="Permanent link">&para;</a></h4>
<ol>
<li>En el controlador <code>EquipoController</code> ya creado, modifica los métodos <code>index</code>, <code>show</code>, <code>create</code>, <code>edit</code> y <code>destroy</code> para obtener los equipos desde la base de datos:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>     <span class="nv">$equipos</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>     <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos=" 5 "></span> <span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span> <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>     <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>     <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.show&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;equipo&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="10 "></span> <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span> <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>     <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.create&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span> <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span> <span class="k">public</span> <span class="k">function</span> <span class="nf">edit</span><span class="p">(</span><span class="nx">Equipo</span> <span class="nv">$equipo</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>     <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.edit&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;equipo&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="18 "></span> <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span> <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>     <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>     <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span>     <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo eliminado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span> <span class="p">}</span>
</code></pre></div>
<h4 id="paso-4-relaciones-entre-modelos">Paso 4: Relaciones entre modelos<a class="headerlink" href="#paso-4-relaciones-entre-modelos" title="Permanent link">&para;</a></h4>
<p>En este punto vamos a crear la tabla <code>estadios</code> mediante una migración, con un seeder la rellenaremos y crearemos el modelo <code>Estadio</code> que lo relacionaremos con <code>Equipo</code>.</p>
<ol>
<li>Crear la migración para crear la tabla <code>estadios</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>create_estadios_table
</code></pre></div>
<ol start="2">
<li>Rellenarla con los siguientes datos:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span> <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;estadios&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
<span class="linenos" data-linenos=" 6 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;ciudad&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;capacidad&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>        <span class="p">});</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
</code></pre></div>
<ol start="3">
<li>Crear la migración para añadir la clave foránea <code>estadio_id</code> a la tabla <code>equipos</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>add_estadio_id_to_equipos_table
</code></pre></div>
<ol start="4">
<li>Rellenarla con los siguientes datos:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="linenos" data-linenos=" 3 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>      <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>          <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span><span class="s1">&#39;estadio&#39;</span><span class="p">);</span> <span class="c1">// Elimina el campo estadio</span>
<span class="linenos" data-linenos=" 6 "></span>          <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">foreignId</span><span class="p">(</span><span class="s1">&#39;estadio_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">constrained</span><span class="p">();</span> <span class="c1">// Añade la clave foránea</span>
<span class="linenos" data-linenos=" 7 "></span>      <span class="p">});</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="linenos" data-linenos="11 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>      <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>          <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;estadio&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>          <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropForeign</span><span class="p">([</span><span class="s1">&#39;estadio_id&#39;</span><span class="p">]);</span>
<span class="linenos" data-linenos="15 "></span>          <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span><span class="s1">&#39;estadio_id&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>      <span class="p">});</span>
<span class="linenos" data-linenos="17 "></span>  <span class="p">}</span>
</code></pre></div>
<ol start="5">
<li>Crear el modelo <code>Estadio</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Estadio
</code></pre></div>
<ol start="6">
<li>Añade en el modelo la relación con <code>Equipo</code> teniendo en cuenta que en 1 estadio pueden jugar muchos equipos y un equipo sólo juega en 1 estadio:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;ciudad&#39;</span><span class="p">,</span> <span class="s1">&#39;capacidad&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">equipos</span><span class="p">(){</span>
<span class="linenos" data-linenos="5 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">Equipo</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="p">}</span>
</code></pre></div>
<ol start="7">
<li>En el modelo <code>Equipo</code> añade la relación:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">estadio</span><span class="p">(){</span>
<span class="linenos" data-linenos="3 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">Estadio</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>    <span class="p">}</span>
</code></pre></div>
<ol start="8">
<li>Crea el seeder <code>EstadiosSeeder</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:seeder<span class="w"> </span>EstadiosSeeder
</code></pre></div>
<ol start="9">
<li>Y rellénalo con los datos de prueba:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="linenos" data-linenos="3 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>      <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;estadios&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span>
<span class="linenos" data-linenos="5 "></span>          <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Camp Nou&#39;</span><span class="p">,</span> <span class="s1">&#39;ciudad&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Barcelona&#39;</span><span class="p">,</span> <span class="s1">&#39;capacidad&#39;</span> <span class="o">=&gt;</span> <span class="mi">99000</span><span class="p">],</span>
<span class="linenos" data-linenos="6 "></span>          <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Wanda Metropolitano&#39;</span><span class="p">,</span> <span class="s1">&#39;ciudad&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Madrid&#39;</span><span class="p">,</span> <span class="s1">&#39;capacidad&#39;</span> <span class="o">=&gt;</span> <span class="mi">68000</span><span class="p">],</span>
<span class="linenos" data-linenos="7 "></span>          <span class="p">[</span><span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Santiago Bernabéu&#39;</span><span class="p">,</span> <span class="s1">&#39;ciudad&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Madrid&#39;</span><span class="p">,</span> <span class="s1">&#39;capacidad&#39;</span> <span class="o">=&gt;</span> <span class="mi">81000</span><span class="p">],</span>
<span class="linenos" data-linenos="8 "></span>      <span class="p">]);</span>
<span class="linenos" data-linenos="9 "></span>  <span class="p">}</span>
</code></pre></div>
<ol start="10">
<li>En el archivo <code>DatabaseSeeder</code> llama también al seeder recién creado y <strong>en primer lugar</strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
<span class="linenos" data-linenos="5 "></span>        <span class="nx">EstadiosSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="c1">// Ojo, llamar en primer lugar</span>
<span class="linenos" data-linenos="6 "></span>        <span class="nx">EquiposSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="7 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<ol start="11">
<li>Modifica el seeder <code>EquiposSeeder</code> para asginar equipos a estadios existentes:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$estadio</span> <span class="o">=</span> <span class="nx">Estadio</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;Camp Nou&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$estadio</span><span class="o">-&gt;</span><span class="na">equipos</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Barça Femenino&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$estadio</span> <span class="o">=</span> <span class="nx">Estadio</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;Wanda Metropolitano&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$estadio</span><span class="o">-&gt;</span><span class="na">equipos</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
<span class="linenos" data-linenos="11 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Atlético de Madrid&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$estadio</span> <span class="o">=</span> <span class="nx">Estadio</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;Santiago Bernabéu&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<span class="linenos" data-linenos="15 "></span>    <span class="nv">$estadio</span><span class="o">-&gt;</span><span class="na">equipos</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
<span class="linenos" data-linenos="16 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Real Madrid Femenino&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="19 "></span><span class="p">}</span>
</code></pre></div>
<ol start="12">
<li>Ejecuta los seeders para llenar las tablas <code>estadios</code> y <code>equipos</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>migrate:fresh<span class="w"> </span>--seed
</code></pre></div>
<ol start="13">
<li>Modifica la vista <code>equipos.index</code> para mostrar correctamente el estadio de cada equipo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">@</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$equipos</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$equipo</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="o">&lt;</span><span class="nx">tr</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;hover:bg-gray-100&quot;</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;border border-gray-300 p-2&quot;</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ route(&#39;equipos.show&#39;, </span><span class="si">$equipo-&gt;id</span><span class="s2">) }}&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-blue-700 hover:underline&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">nombre</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="o">&lt;/</span><span class="nx">td</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;border border-gray-300 p-2&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">estadio</span><span class="o">-&gt;</span><span class="na">nombre</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="nx">td</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;border border-gray-300 p-2&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">titulos</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="nx">td</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="o">&lt;/</span><span class="nx">tr</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="o">@</span><span class="k">endforeach</span>
</code></pre></div>
<ol start="14">
<li>Crea la vista <code>equipos.create</code> con el formulario para crear un equipo que incluya una lista desplegable con los estadios disponibles:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>@extends(&#39;layouts.app&#39;)
<span class="linenos" data-linenos=" 2 "></span>@section(&#39;title&#39;, &quot;Guía de equipos&quot;)
<span class="linenos" data-linenos=" 3 "></span>@section(&#39;content&#39;)
<span class="linenos" data-linenos=" 4 "></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;equipos.store&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bg-white p-6 rounded-lg shadow-md max-w-md mx-auto&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>    @csrf
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Nombre:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">required</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;titulos&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Títulos:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;titulos&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;titulos&quot;</span> <span class="na">required</span>
<span class="linenos" data-linenos="15 "></span>            <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;estadio_id&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Estadio:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="20 "></span>        <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;estadio_id&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;estadio_id&quot;</span> <span class="na">required</span>
<span class="linenos" data-linenos="21 "></span>            <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="22 "></span>            @foreach ($estadios as $estadio)
<span class="linenos" data-linenos="23 "></span>                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ $estadio-&gt;id }}&quot;</span><span class="p">&gt;</span>{{ $estadio-&gt;nombre }}<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="24 "></span>            @endforeach
<span class="linenos" data-linenos="25 "></span>        <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
<span class="linenos" data-linenos="29 "></span>        <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full bg-blue-500 text-white font-medium py-2 px-4 rounded-lg shadow hover:bg-blue-600 focus:ring focus:ring-blue-300&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="30 "></span>        Crear Equipo
<span class="linenos" data-linenos="31 "></span>    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="32 "></span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="33 "></span>@endsection 
</code></pre></div>
<ol start="15">
<li>En la vista <code>equipos.index</code> incluir justo después de la tabla un botón que vaya a la ruta anterior:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10 text-center&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/equipos/create&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bg-blue-700 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-full&quot;</span><span class="p">&gt;</span>Crear equipo<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="3 "></span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
<ol start="16">
<li>En el controlador <code>EquipoController</code> modificar la función <code>create</code> para recuperar y pasar a la vista los estadios. Y también la función <code>store</code> para recibir los datos del formulario y crear el equipo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$estadios</span> <span class="o">=</span> <span class="nx">Estadio</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.create&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;estadios&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:equipos&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer|min:0&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span>        <span class="s1">&#39;estadio_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|exists:estadios,id&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nx">Equipo</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;mensaje&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo creado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<ol start="16">
<li>Para que la asignación másiva funcione, en el modelo <code>Equipo</code> hay que modificar el atributo <code>$fillable</code> cambiando el antiguo string <code>estadio</code> por el nuevo <code>estadio_id</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio_id&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span><span class="p">];</span>
</code></pre></div>
<ol start="17">
<li>Crea la vista <code>equipos.edit</code> con el formulario para editar un equipo que incluya una lista desplegable con los estadios disponibles:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>@extends(&#39;layouts.app&#39;)
<span class="linenos" data-linenos=" 2 "></span>@section(&#39;title&#39;, &quot;Guía de equipos&quot;)
<span class="linenos" data-linenos=" 3 "></span>@section(&#39;content&#39;)
<span class="linenos" data-linenos=" 4 "></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;equipos.update&#39;, $equipo-&gt;id) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bg-white p-6 rounded-lg shadow-md max-w-md mx-auto&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>    @csrf
<span class="linenos" data-linenos=" 6 "></span>    @method(&#39;PUT&#39;)
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Nombre:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="10 "></span>        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ old(&#39;nombre&#39;, $equipo-&gt;nombre) }}&quot;</span> <span class="na">required</span>
<span class="linenos" data-linenos="11 "></span>            <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 </span>
<span class="linenos" data-linenos="12 "></span><span class="s">            @error(&#39;nombre&#39;) border-red-500 @enderror&quot;</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="13 "></span>        @error(&#39;nombre&#39;)
<span class="linenos" data-linenos="14 "></span>            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-red-500 text-sm mt-1&quot;</span><span class="p">&gt;</span>{{ $message }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="15 "></span>        @enderror
<span class="linenos" data-linenos="16 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;titulos&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Títulos:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="20 "></span>        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;titulos&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;titulos&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ old(&#39;titulos&#39;, $equipo-&gt;titulos) }}&quot;</span> <span class="na">required</span>
<span class="linenos" data-linenos="21 "></span>            <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 </span>
<span class="linenos" data-linenos="22 "></span><span class="s">            @error(&#39;titulos&#39;) border-red-500 @enderror&quot;</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="23 "></span>        @error(&#39;titulos&#39;)
<span class="linenos" data-linenos="24 "></span>            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-red-500 text-sm mt-1&quot;</span><span class="p">&gt;</span>{{ $message }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="25 "></span>        @enderror
<span class="linenos" data-linenos="26 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="29 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;estadio_id&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Estadio:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="30 "></span>        <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;estadio_id&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;estadio_id&quot;</span> <span class="na">required</span>
<span class="linenos" data-linenos="31 "></span>            <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 </span>
<span class="linenos" data-linenos="32 "></span><span class="s">            @error(&#39;estadio_id&#39;) border-red-500 @enderror&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="33 "></span>            @foreach ($estadios as $estadio)
<span class="linenos" data-linenos="34 "></span>                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ $estadio-&gt;id }}&quot;</span> <span class="err">{{</span> <span class="err">$</span><span class="na">estadio-</span><span class="p">&gt;</span>id == $equipo-&gt;estadio_id ? &#39;selected&#39; : &#39;&#39; }}&gt;
<span class="linenos" data-linenos="35 "></span>                    {{ $estadio-&gt;nombre }}
<span class="linenos" data-linenos="36 "></span>                <span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="37 "></span>            @endforeach
<span class="linenos" data-linenos="38 "></span>        <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="39 "></span>        @error(&#39;estadio_id&#39;)
<span class="linenos" data-linenos="40 "></span>            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-red-500 text-sm mt-1&quot;</span><span class="p">&gt;</span>{{ $message }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="41 "></span>        @enderror
<span class="linenos" data-linenos="42 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="43 "></span>
<span class="linenos" data-linenos="44 "></span>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
<span class="linenos" data-linenos="45 "></span>        <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full bg-blue-500 text-white font-medium py-2 px-4 rounded-lg shadow hover:bg-blue-600 focus:ring focus:ring-blue-300&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="46 "></span>        Actualizar Equipo
<span class="linenos" data-linenos="47 "></span>    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="48 "></span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="49 "></span>@endsection 
</code></pre></div>
<ol start="18">
<li>Añade en la vista <code>equipos.index</code> los enlaces para eliminar un equipo y mostrar el formulario de actualizar anterior. Algo así:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;border border-gray-300 p-2 text-center&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;equipos.edit&#39;, $equipo-&gt;id) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-blue-700 hover:underline&quot;</span><span class="p">&gt;</span>📝<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;equipos.destroy&#39;, $equipo-&gt;id) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="4 "></span>        @csrf
<span class="linenos" data-linenos="5 "></span>        @method(&#39;DELETE&#39;)
<span class="linenos" data-linenos="6 "></span>        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-red-700 hover:underline&quot;</span><span class="p">&gt;</span>❌<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="7 "></span>    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</code></pre></div>
<ol start="19">
<li>En el controlador <code>EquipoController</code> modificar la función <code>edit</code> para recuperar y pasar a la vista los estadios. Y también la función <code>update</code> para recibir los datos del formulario y actualizar el equipo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">edit</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>      <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span>      <span class="nv">$estadios</span> <span class="o">=</span> <span class="nx">Estadio</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span>      <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.edit&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;equipo&#39;</span><span class="p">,</span> <span class="s1">&#39;estadios&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos=" 6 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos=" 9 "></span>      <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
<span class="linenos" data-linenos="10 "></span>          <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:equipos,nombre,&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span>          <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer|min:0&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span>          <span class="s1">&#39;estadio_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|exists:estadios,id&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span>      <span class="p">]);</span>
<span class="linenos" data-linenos="14 "></span>      <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>      <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>      <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;mensaje&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo actualizado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>      <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>      <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="linenos" data-linenos="22 "></span>      <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;mensaje&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo eliminado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>  <span class="p">}</span>
</code></pre></div>
<ol start="20">
<li>En la vista <code>equipos.index</code> podemos mejorar la experiencia de usuario añadiendo un "Toast" propio en el que se muestren los mensajes de confirmación cuando se añaden, modifican o eliminan equipos. Justo antes de la tabla de equipos, añade:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>@if (session(&#39;mensaje&#39;))
<span class="linenos" data-linenos=" 2 "></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;toast&#39;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fixed bottom-5 right-5 flex items-center bg-green-600 text-white text-sm font-semibold px-6 py-3 rounded-lg shadow-lg animate-slide-in&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-5 h-5 mr-2&quot;</span> <span class="na">fill</span><span class="o">=</span><span class="s">&quot;none&quot;</span> <span class="na">stroke</span><span class="o">=</span><span class="s">&quot;currentColor&quot;</span> <span class="na">stroke-width</span><span class="o">=</span><span class="s">&quot;2&quot;</span> <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 24 24&quot;</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="p">&lt;</span><span class="nt">path</span> <span class="na">stroke-linecap</span><span class="o">=</span><span class="s">&quot;round&quot;</span> <span class="na">stroke-linejoin</span><span class="o">=</span><span class="s">&quot;round&quot;</span> <span class="na">d</span><span class="o">=</span><span class="s">&quot;M5 13l4 4L19 7&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">path</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 6 "></span>    {{ session(&#39;mensaje&#39;) }}
<span class="linenos" data-linenos=" 7 "></span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="cm">&lt;!-- Script para desaparecer el toast después de 3 segundos --&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;toast&#39;</span><span class="p">).</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;opacity-0&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;toast&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">(),</span><span class="w"> </span><span class="mf">500</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">3000</span><span class="p">);</span><span class="w"> </span>
<span class="linenos" data-linenos="15 "></span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="16 "></span>@endif
</code></pre></div>
<h4 id="paso-5-anadir-un-escudo-al-equipo">Paso 5: Añadir un escudo al equipo<a class="headerlink" href="#paso-5-anadir-un-escudo-al-equipo" title="Permanent link">&para;</a></h4>
<p>A continuación vas a realizar los pasos necesarios para poder subir una imagen como escudo de cada equipo.</p>
<ol>
<li>Crea la migración para añadir el campo <code>escudo</code> a la tabla <code>equipos</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:migraton<span class="w"> </span>add_escudo_to_equipos_table
</code></pre></div>
<ol start="2">
<li>En el archivo de migración creado, añade el campo <code>escudo</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;escudo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">});</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;equipos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span><span class="s1">&#39;escudo&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">});</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<ol start="3">
<li>Ejecutar la migración:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<ol start="4">
<li>Modifica el modelo <code>Equipo</code> para añadir el campo <code>escudo</code> a <code>$fillable</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio_id&#39;</span><span class="p">,</span> <span class="s1">&#39;titulos&#39;</span><span class="p">,</span> <span class="s1">&#39;escudo&#39;</span><span class="p">];</span>
</code></pre></div>
<ol start="5">
<li>Modifica la vista <code>equipos.create</code> para incluir un campo de archivo para subir el escudo del equipo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;escudo&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Escudo:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;escudo&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;escudo&quot;</span>
<span class="linenos" data-linenos="4 "></span>        <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<ol start="6">
<li>Modifica la vista <code>equipos.edit</code> para incluir un campo de archivo para actualizar el escudo del equipo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;escudo&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span><span class="p">&gt;</span>Escudo:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;escudo&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;escudo&quot;</span> 
<span class="linenos" data-linenos="4 "></span>        <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="5 "></span>    @if ($equipo-&gt;escudo)
<span class="linenos" data-linenos="6 "></span>        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-2 text-sm text-gray-500&quot;</span><span class="p">&gt;</span>Escudo actual:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="7 "></span>        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ asset(&#39;storage/&#39; . $equipo-&gt;escudo) }}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Escudo de {{ $equipo-&gt;nombre }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;h-16 mt-2&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="8 "></span>    @endif
<span class="linenos" data-linenos="9 "></span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<ol start="7">
<li>Añade <code>enctype="multipart/form-data"</code> a los dos formularios:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;equipos.store&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bg-white p-6 rounded-lg shadow-md max-w-md mx-auto&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;equipos.update&#39;, $equipo-&gt;id) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bg-white p-6 rounded-lg shadow-md max-w-md mx-auto&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<ol start="8">
<li>Para acceder a archivos desde el navegador mediante su ruta y poder incluirlos en las vistas, es necesario crear un enlace simbólico en <code>/public</code> que apunte a <code>/storage/app/public</code> (o donde mande el disco configurado). Ejecuta:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>storage:link
</code></pre></div>
<ol start="9">
<li>Actualiza el método <code>store</code> del controlador para guardar la imagen del escudo  en el subdirectorio <code>escudos</code> en el disco público <code>/storage/app/public</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:equipos&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer|min:0&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="s1">&#39;estadio_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|exists:estadios,id&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;escudo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;nullable|image|mimes:jpeg,png,jpg|max:2048&#39;</span><span class="p">,</span> <span class="c1">// Validación del fichero</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">hasFile</span><span class="p">(</span><span class="s1">&#39;escudo&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;escudo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;escudos&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span> <span class="c1">// Guardar en directorio &#39;escudos&#39; en disco &#39;public&#39;</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$validated</span><span class="p">[</span><span class="s1">&#39;escudo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$path</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="nx">Equipo</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;mensaje&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo creado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div>
<ol start="10">
<li>Actualiza el método <code>update</code> del controlador para actualizar la imagen del escudo en el subdirectorio <code>escudos</code> en el disco público <code>/storage/app/public</code> eliminando el fichero anterior si existiera:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:equipos,nombre,&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer|min:0&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="s1">&#39;estadio_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|exists:estadios,id&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;escudo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;nullable|image|mimes:jpeg,png,jpg|max:2048&#39;</span><span class="p">,</span> <span class="c1">// Validación del fichero</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">hasFile</span><span class="p">(</span><span class="s1">&#39;escudo&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">escudo</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>            <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">escudo</span><span class="p">);</span> <span class="c1">// Borra el fichero anterior si lo tuviera</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;escudo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;escudos&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span> <span class="c1">// Guardar en directorio &#39;escudos&#39; en disco &#39;public&#39;</span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$validated</span><span class="p">[</span><span class="s1">&#39;escudo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$path</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;mensaje&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo actualizado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span><span class="p">}</span>
</code></pre></div>
<ol start="11">
<li>Actualiza el método <code>destroy</code> para eliminar también de disco el escudo:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">escudo</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">escudo</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="7 "></span>    <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="linenos" data-linenos="8 "></span>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;equipos.index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;mensaje&#39;</span><span class="p">,</span> <span class="s1">&#39;Equipo eliminado correctamente!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="paso-6-mostrar-el-escudo-del-equipo-en-la-vista-en-detalle">Paso 6: Mostrar el escudo del equipo en la vista en detalle<a class="headerlink" href="#paso-6-mostrar-el-escudo-del-equipo-en-la-vista-en-detalle" title="Permanent link">&para;</a></h4>
<p>Para mostrar la imagen del escudo en la vista en detalle del equipo hay que modificar el componente de la vista <code>Equipo</code> que se creó en su día. También se podría haber mostrado directamente en la vista sin necesidad de crear el componente. Paso a paso, realiza las siguientes acciones.</p>
<ol>
<li>En el controlador <code>EquipoController</code> modfica la función <code>show</code> para pasar el nombre del estadio:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$equipo</span> <span class="o">=</span> <span class="nx">Equipo</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$estadio</span> <span class="o">=</span> <span class="nv">$equipo</span><span class="o">-&gt;</span><span class="na">estadio</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;equipos.show&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;equipo&#39;</span><span class="p">,</span> <span class="s1">&#39;estadio&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<ol start="2">
<li>Modifica el componente de la vista <code>equipos.show</code> para mostrar la imagen del escudo del equipo. En el caso de que un equipo no tenga escudo (null), se le pasa la cadena vacía '' para que se construya bien el componente porque requiere string y fallaría con null:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">x-equipo</span>
<span class="linenos" data-linenos="2 "></span>   <span class="na">:nombre</span><span class="o">=</span><span class="s">&quot;$equipo[&#39;nombre&#39;]&quot;</span>
<span class="linenos" data-linenos="3 "></span>   <span class="na">:estadio</span><span class="o">=</span><span class="s">&quot;$estadio&quot;</span>
<span class="linenos" data-linenos="4 "></span>   <span class="na">:titulos</span><span class="o">=</span><span class="s">&quot;$equipo[&#39;titulos&#39;]&quot;</span>
<span class="linenos" data-linenos="5 "></span>   <span class="na">:escudo</span><span class="o">=</span><span class="s">&quot;$equipo[&#39;escudo&#39;] ?? &#39;&#39;&quot;</span> 
<span class="linenos" data-linenos="6 "></span><span class="p">/&gt;</span>
</code></pre></div>
<p>Otra opción hubiera sido poner una imagen de escudo por defecto, quedando esa línea así: <code>:escudo="$equipo['escudo'] ?? 'escudos/default.png'"</code>.</p>
<ol start="3">
<li>En el constructor del componente de la vista <code>Equipo</code>, añadir el campo escudo. Está en <code>app/View/Components/Equipo.php</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$estadio</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">public</span> <span class="nx">int</span> <span class="nv">$titulos</span><span class="p">,</span>
<span class="linenos" data-linenos="6 "></span>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$escudo</span> <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
<ol start="4">
<li>En la vista del componente de la vista <code>Equipo</code>, añadir la imagen. Está en <code>resources/views/components/equipo.blade.php</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;equipo border rounded-lg shadow-md p-4 bg-white&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span>    @if ($escudo)
<span class="linenos" data-linenos=" 3 "></span>       <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 4 "></span>            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ asset(&#39;storage/&#39; . $escudo) }}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Escudo de {{ $nombre }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;h-8 w-8 object-cover rounded-full&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 6 "></span>    @endif
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-xl font-bold text-blue-800&quot;</span><span class="p">&gt;</span>{{ $nombre }}<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Estadio:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $estadio }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Títulos:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $titulos }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="paso-7-utilizar-factorias-para-datos-de-ejemplo">Paso 7: Utilizar factorías para datos de ejemplo<a class="headerlink" href="#paso-7-utilizar-factorias-para-datos-de-ejemplo" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una factoría para el modelo <code>Estadio</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:factory<span class="w"> </span>EstadioFactory<span class="w"> </span>--model<span class="o">=</span>Estadio
</code></pre></div>
<ol start="2">
<li>Modifica la factoría para crear datos aleatorios:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">definition</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos="5 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">city</span><span class="o">.</span><span class="s1">&#39; Stadium&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="6 "></span>        <span class="s1">&#39;ciudad&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">city</span><span class="p">,</span>
<span class="linenos" data-linenos="7 "></span>        <span class="s1">&#39;capacidad&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">numberBetween</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
<span class="linenos" data-linenos="8 "></span>    <span class="p">];</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<ol start="3">
<li>Actualiza el seeder <code>EstadiosSeeder</code> para utilizar la factoría:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="c1">//...</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nx">Estadio</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<ol start="4">
<li>Modifica el modelo <code>Estadio</code> para permitir factorías:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">class</span> <span class="nc">Estadio</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos="6 "></span><span class="p">{</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span>    <span class="c1">// ...</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<ol>
<li>Repetimos el proceso, ahora para <code>Equipo</code>. Crea su factoría:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php<span class="w"> </span>artisan<span class="w"> </span>make:factory<span class="w"> </span>EquipoFactory<span class="w"> </span>--model<span class="o">=</span>Equipo
</code></pre></div>
<ol start="6">
<li>Modifica la factoría para crear datos aleatorios:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">definition</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">company</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="s1">&#39;titulos&#39;</span> <span class="o">=&gt;</span> <span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">numberBetween</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;estadio_id&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Models\Estadio</span><span class="o">::</span><span class="na">factory</span><span class="p">(),</span> <span class="c1">// Crea un estadio mediante su factoría</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="s1">&#39;escudo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;escudos/default.png&#39;</span><span class="p">,</span> <span class="c1">// Imagen por defecto</span>
<span class="linenos" data-linenos=" 9 "></span>      <span class="p">];</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Atención</p>
<p>Al llamar a la factoría de <code>Estadio</code> en el punto anterior, ya no es necesario llamar llamar en <code>DatabaseSeeder</code> al seeder <code>EstadiosSeeder</code> que a su vez llama a la factoría. Directamente se crearían los estadios al llamar al seeder <code>EquiposSeeder</code> siguiente.</p>
</div>
<ol start="7">
<li>Actualiza el seeder <code>EquiposSeeder</code> para utilizar la factoría:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="c1">//...</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nx">Equipo</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<ol start="8">
<li>Modifica el modelo <code>Equipo</code> para permitir factorías:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">class</span> <span class="nc">Equipo</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="linenos" data-linenos="6 "></span><span class="p">{</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span>    <span class="c1">// ...</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="resultado-de-la-aplicacion">Resultado de la aplicación<a class="headerlink" href="#resultado-de-la-aplicacion" title="Permanent link">&para;</a></h4>
<figure style="align: center;">
    <img src="imagenes/09/futbol-femenino-tema9.gif">
    <figcaption>Ejemplo de navegación por la app</figcaption>
</figure>

<h3 id="practica-guia-de-estadios-de-futbol">Práctica: Guía de estadios de fútbol<a class="headerlink" href="#practica-guia-de-estadios-de-futbol" title="Permanent link">&para;</a></h3>
<p>El objetivo de esta práctica es crear una extensión de la guía de equipos de fútbol femenino para incluir la funcionalidad de estadios, jugadoras y partidos.</p>
<p>Pasos a Seguir:</p>
<ol>
<li><strong>Completa el CRUD de estadios</strong></li>
</ol>
<ul>
<li>Añade los métodos create, store, edit, update y destroy al controlador <code>EstadioController</code>.</li>
<li>Modifica las vistas para la gestión del estadio (index, show, create, edit).</li>
<li>Modifica el componente de estadio para mostrar los equipos que juegan.</li>
</ul>
<ol start="2">
<li><strong>Jugadoras y partidos: Crear Migraciones y Modelos</strong></li>
</ol>
<ul>
<li>Genera una migración para las jugadoras, asociándolas con un equipo y con la posibilidad de poner una foto cada una.</li>
<li>Añade una migración para la tabla partidos, incluyendo equipos locales y visitantes, fecha del partido y resultado.</li>
<li>Ejecuta todas las migraciones.</li>
</ul>
<ol start="3">
<li><strong>Seeders y Factorías</strong></li>
</ol>
<ul>
<li>Crea seeders para las tablas jugadoras y partidos.</li>
<li>Usa factorías para generar datos de ejemplo para jugadoras y partidos.</li>
</ul>
<ol start="4">
<li><strong>Modelos y Relaciones</strong></li>
</ol>
<p>Define las relaciones en los modelos:</p>
<ul>
<li>Un equipo tiene muchas jugadoras.</li>
<li>Un equipo puede tener muchos partidos como local o visitante.</li>
<li>Un partido tiene un equipo local y un equipo visitante.</li>
<li>Define las relaciones inversas y ajusta las configuraciones según sus necesidades.</li>
</ul>
<ol start="5">
<li><strong>Implementa las funcionalidades CRUD de jugadoras y partidos</strong></li>
</ol>
<ul>
<li>Implementa formularios para crear y editar jugadoras y partidos.</li>
<li>Asegúrate de que los campos estén correctamente validados antes de guardar los datos.</li>
<li>Cada jugador puede o no tener una foto.</li>
</ul>
<ol start="6">
<li><strong>Vistas y Componentes</strong></li>
</ol>
<ul>
<li>Modifica el componente de equipos para mostrar a las jugadoras.</li>
</ul>
<hr />
<h4 id="preguntas-para-reflexionar">Preguntas para reflexionar<a class="headerlink" href="#preguntas-para-reflexionar" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Migraciones</strong>: ¿Qué ventajas tiene utilizar migraciones para gestionar el esquema de la base de datos?</li>
<li><strong>Relaciones</strong>: ¿Cómo gestionarías las relaciones many-to-many (por ejemplo, entre equipos y partidos)?</li>
<li><strong>Blade y Componentes</strong>: ¿Qué beneficios aporta el uso de componentes Blade en formularios complejos?</li>
</ol>
<!-- 
### Práctica: FernanChollo 

901. Crear el proyecto FernanChollo:

  - Crea un nuevo repositorio para el proyecto
  - Configura el `.gitignore` para no incluir en el repo los siguientes archivos y carpetas:
      - carpeta `vendor`
      - archivos `.env` y cualquier archivo que empiece por `.` excepto el `.gitignore`
  - La página principal del sitio debe ser un listado con todos los chollos disponibles
  - Configura la base de datos con Eloquent, olvídate de usar la consola mysql
  - Crea una vista para las siguientes acciones:
      - Crear un chollo
      - Editar un chollo
  - La tabla Chollo debe contener las siguientes columnas:
      - `id` único y autoincremental
      - `titulo` un título para el chollo
      - `descripcion` descripcion del chollo
      - `url` un campo para introducir la URL externa del chollo
      - `categoria` albergará la categoría de los chollos
      - `puntuacion` un número entero que indique la puntuación del chollo
      - `precio` para albergar el precio del chollo
      - `precio_descuento` para albergar el nuevo precio
      - `disponible` de tipo boolean
  - Por lo menos, el sitio debe contener un `controlador` de Laravel; puedes crear tantos como creas necesarios pero mínimo debe haber uno.

`::: Elementos estáticos`
Como ya hemos visto, hay ciertos elementos que siempre se muestran en todas las vistas del sitio web. A continuación se listan los elementos que deben estar si o si en todas las plantillas que creéis.

  - Logo del sitio y el título `Chollo ░▒▓ Severo`
  - `Inicio` | `Nuevos` | `Destacados`
  - Un footer con vuestro nombre y algún dato copyright del tipo `©FernanChollo 2025` donde el año debe ser calculado a través de la fecha del servidor.

`::: Pagína principal` <br>
Además del listado de todos los chollos de la base de datos debe contener el menú de navegación:

  - Cada chollo debe ser accesible desde este listado
  - Cada chollo debe contener una imagen que estará guardada en `public/img`
  - Cada chollo debe contener sus botones de `editar` y `borrar` que haga las funciones que tocan. Puedes utilizar iconos para cada uno de los botones.
  - El nombre de las imágenes debe estar compuesta por la siguiente fórmula `idChollo`-chollo-severo.`extension`
      - Por ejemplo: 25-chollo-severo.jpg
  - La imagen del chollo no se sube a través del formulario, la pones directamente en la carpeta. Si te animas a subirlo a través del formulario, puedes hacerlo.

`::: Página de Chollo` <br>
Cuando pinchemos en uno de los chollos del listados debemos ser redireccionados a esta vista donde podremos ver toda la información del tabla chollo. Puedes maquetarla como quieras e incluso puedes basarte en la web de [Chollo Metro](https://www.chollometro.com). El campo `disponible` no es necesario que lo muestres en esta vista

`::: Página de Crear un chollo` <br>
Un formulario con los campos necesarios para poder crear un chollo nuevo. Además, debes tener en cuenta que tienes que validar los campos, de tal manera que no se pueda enviar el formulario si se ha dejado algún campo en blanco; dichas validaciones, además de añadir la propiedad `required` de HTML5 debes hacerlo con Laravel.

En caso de que haya habido algún error en el formulario debes mostrar un mensaje en la parte de arriba del mismo con el mensaje de error (por ejemplo, si el campo está vacío).

`::: Página de Editar un chollo` <br>
Muy parecida a la de Crear un chollo pero que puedas editar un Chollo en función de su `id`. Acuérdate que no puedes dejar ningún campo vacío, para ello has de utilizar las validaciones de Laravel.

`░▒▓ COSAS A TENER EN CUENTA ░▒▓` <br>
- Tienes que usar `Bootstrap` o `Material Design`, aunque si lo prefieres puedes hacer tus propios archivos `.css`

- Los mensajes de error o de información deben estar estilizados para que el usuario pueda verlos con facilidad

- Los elementos estáticos deben estar presentes en todas las vistas; incluidas las de editar y crear.

- Las plantillas que formen parte de otra ya creada deben estar en una carpeta con el nombre de la plantilla madre, como hicimos con el ejercicio de `Notas`:

<div class="center img-large">
    <img src="imagenes/07/estructura-ficheros.png">
</div>

- Ve haciendo commits en función de las tareas que vayas acabando o que veas que el commit tiene sentido. No es buena práctica subir los camios de un archivo y el siguiente commit volver a subir más cambios del mismo archivo (a no ser que nos hayamos saltado o equivocado en algo).

- El proyecto es individual y después se presentará, uno por uno al profesor para que evalúe todos los aspectos del mismo. Se harán preguntas de cómo se ha hecho cierta cosa o por qué se ha determinado cierto flujo de trabajo así que, <span class="alert">***no os copiéis porque se evalúa también la presentación del proyecto***</span>

-->












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2025-2026 Eladio Blanco. Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/eladioblanco" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<eladio.blanco@fernando3martos.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link"], "search": "assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>